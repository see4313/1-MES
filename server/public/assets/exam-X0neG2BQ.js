import{_ as Q}from"./card-header-btn-DywzlSP9.js";import{_ as q}from"./card-header-btn2-BNncrG3u.js";import{s as A,a as u}from"./index-C6cMUqqj.js";import{_ as g}from"./CommonModal-eUFOkW9R.js";import{a as y}from"./index-NIGUFBhG.js";import{d as S}from"./dayjs.min-CQa8u9th.js";import{_ as G}from"./SnackBar-EkLInYn6.js";import{u as H}from"./useSnackBar-CsLaRa2S.js";import{r as s,m as J,M,c as K,o as O,b as l,w as t,Q as E,T as C,U as d,ac as $,a0 as b,d as m,N as I,a as W,u as r,t as X,V as Z,F as P}from"./index-BkcQ_3tW.js";import"./_commonjsHelpers-gnU0ypJ3.js";const ee={class:"card"},pe={__name:"exam",setup(le){const{snackBar:o}=H(),i=s([]),x=s(!1),k=s(!1),w=s(null),p=s(null),V=s(null),v=s(null),f=s(null),c=s(null),_=s(null);J(()=>{}),M(()=>regDate.value?S(regDate.value).format("YYYY-MM-DD"):""),M(()=>papDate.value?S(papDate.value).format("YYYY-MM-DD"):"");const Y=async()=>{try{return(await y.get("/api/selectEmp")).data}catch{return o("조회 실패.","error"),[]}},B=async()=>{try{const a={uon:"Y"};return(await y.get("/api/itemList",{params:a})).data}catch{return o("조회 실패.","error"),[]}},F=async()=>{try{const a={uon:"Y"};return(await y.get("/api/inspList",{params:a})).data}catch{return o("조회 실패.","error"),[]}},N=a=>{w.value=a.item_id,p.value=a.item_name},z=a=>{V.value=a.emp_id,v.value=a.emp_name},R=a=>{_.value=a,c.value=!0},U=a=>{if(_.value!=null){const e=i.value[_.value];e.insp_id=a.insp_id,e.insp_nm=a.insp_nm,e.insp_mthd=a.insp_mthd,e.insp_typ=a.insp_typ,e.basi_val=a.basi_val,c.value=!1,_.value=null}},L=()=>{i.value.push({insp_id:"",insp_nm:"",insp_mthd:"",insp_typ:"",basi_val:""})},T=a=>{confirm("삭제하시겠습니까?")&&i.value.splice(a,1)},D=()=>{w.value=null,p.value=null,V.value=null,v.value=null,f.value=null},h=async()=>{if(!i.value||i.value.length===0){o("상세 항목을 하나 이상 선택해주세요.","warning");return}if(confirm("등록하시겠습니까?"))try{const a={item_id:w.value,emp_id:V.value,remk:f.value,details:i.value.map(n=>({insp_id:n.insp_id}))};(await y.post("/api/examInsert",a)).data.result?(o("등록 성공","success"),D(),i.value=[]):o("등록 실패.","error")}catch{o("에러","error")}};return(a,e)=>(O(),K(P,null,[l(I,{elevation:"10"},{default:t(()=>[l(E,{class:"py-6 px-6"},{default:t(()=>[l(q,{title:"검사서 등록","btn-text1":"초기화","btn-variant1":"flat","btn-color1":"secondary",onBtnClick1:e[0]||(e[0]=n=>D()),"btn-text2":"등록","btn-variant2":"flat","btn-color2":"primary",onBtnClick2:e[1]||(e[1]=n=>h())}),l(C,null,{default:t(()=>[l(d,{cols:"12",md:"12"},{default:t(()=>[l(C,{justify:"space-between",dense:""},{default:t(()=>[l(d,{cols:"12",sm:"4"},{default:t(()=>[l($,{label:"품목",modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=n=>p.value=n),variant:"outlined",readonly:""},{"append-inner":t(()=>[l(b,{onClick:e[2]||(e[2]=n=>k.value=!0),class:"cursor-pointer"},{default:t(()=>e[11]||(e[11]=[m("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(d,{cols:"12",sm:"4"},{default:t(()=>[l($,{label:"담당자",modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=n=>v.value=n),variant:"outlined",readonly:""},{"append-inner":t(()=>[l(b,{onClick:e[4]||(e[4]=n=>x.value=!0),class:"cursor-pointer"},{default:t(()=>e[12]||(e[12]=[m("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(d,{cols:"12",sm:"4"},{default:t(()=>[l($,{label:"비고",modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=n=>f.value=n),variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(I,{elevation:"10",class:"mt-3"},{default:t(()=>[l(E,{class:"py-6 px-6"},{default:t(()=>[l(Q,{title:"검사 상세","btn-text":"행 추가","btn-variant":"flat","btn-color":"#424242",onBtnClick:e[7]||(e[7]=n=>L())}),l(C,null,{default:t(()=>[l(d,{cols:"12",md:"12"},{default:t(()=>[W("div",ee,[l(r(A),{value:i.value,paginator:"",rows:10,tableStyle:"min-width: 50rem; table-layout: fixed;"},{default:t(()=>[l(r(u),{header:"검사번호",style:{width:"180px"}},{body:t(n=>[m(X(n.data.insp_id)+" ",1),l(b,{small:"",class:"ml-2 cursor-pointer",onClick:j=>R(n.index)},{default:t(()=>e[13]||(e[13]=[m("mdi-magnify")])),_:2},1032,["onClick"])]),_:1}),l(r(u),{field:"insp_nm",header:"검사명",style:{width:"200px"}}),l(r(u),{field:"insp_mthd",header:"검사방식",style:{width:"150px"}}),l(r(u),{field:"insp_typ",header:"검사유형",style:{width:"100px"}}),l(r(u),{field:"basi_val",header:"기준값",style:{width:"100px"}}),l(r(u),{style:{width:"80px","text-align":"center"}},{body:t(n=>[l(Z,{icon:"",color:"error",onClick:j=>T(n.index)},{default:t(()=>[l(b,{size:"20"},{default:t(()=>e[14]||(e[14]=[m("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["value"])])]),_:1})]),_:1})]),_:1})]),_:1}),l(g,{visible:x.value,title:"사원",idField:"emd_id",columns:[{key:"emp_id",label:"사원번호"},{key:"emp_name",label:"사원이름"}],fetchData:Y,pageSize:5,onSelect:z,onClose:e[8]||(e[8]=n=>x.value=!1)},null,8,["visible"]),l(g,{visible:k.value,title:"품목",idField:"item_id",columns:[{key:"item_id",label:"품목번호"},{key:"item_name",label:"품목명"},{key:"unit",label:"단위"},{key:"spec",label:"규격"}],fetchData:B,pageSize:5,onSelect:N,onClose:e[9]||(e[9]=n=>k.value=!1)},null,8,["visible"]),l(g,{visible:c.value,title:"품목",idField:"insp_id",columns:[{key:"insp_id",label:"검사번호"},{key:"insp_nm",label:"검사명"},{key:"insp_mthd",label:"검사방식"},{key:"insp_typ",label:"검사유형"},{key:"basi_val",label:"기준값"}],fetchData:F,pageSize:5,onSelect:U,onClose:e[10]||(e[10]=n=>c.value=!1)},null,8,["visible"]),l(G)],64))}};export{pe as default};
