import{a as B}from"./index-NIGUFBhG.js";import{_ as h}from"./CommonModal-DAUXa4tk.js";import{_ as ee}from"./card-header-btn-CibSipEU.js";import{u as te}from"./useFormatDate-DuO0KNBS.js";import{_ as le}from"./SnackBar-HH3n22ps.js";import{u as ae}from"./useSnackBar-IN_qynCK.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as i,D as z,M as F,c as V,o as v,b as a,w as n,U as L,N as D,Q as M,K as j,as as ue,F as N,z as _,W as q,a as l,T as A,V as g,d as c,x as Q,ap as R,u as b,ac as $,s as E,al as oe,v as se,a0 as G,t as o,a6 as ie,af as re,e as de,h as me}from"./index-vUQOwfGq.js";const ve={class:"text-center"},ce={class:"text-center"},fe={class:"text-center"},pe={class:"text-center"},ye={class:"text-center"},Ve={class:"unit-label"},be={class:"text-center"},xe={class:"text-center mb-4"},ke={__name:"instruction",setup(ge){const{snackBar:m}=ae(),{formatDate:f,minDate:P}=te(),p=i("semi"),C=i(!1),s=i([]),I=i(!1),r=i(null),w=i(!1),d=i(null),x=i(""),k=i(!1),S=i([{key:"반제품",value:"semi"},{key:"완제품",value:"finish"}]);z(p,()=>{s.value=[]}),z(()=>s.value.map(u=>u.quantity),()=>{for(const u of s.value){const e=u.quantity;(e<0||e===""||Number.isNaN(e))&&(u.quantity=0)}});const T=u=>{if(!u&&u!==0)return"";const e=Number(u);return Number.isNaN(e)?"":e.toLocaleString()},K=u=>{if(!u)return 0;const e=Number(String(u).replace(/,/g,""));return Number.isNaN(e)?0:e},W=(u,e)=>{const t=K(e);u.quantity=t<0?0:Math.floor(t)},H=async()=>{try{const{data:u}=await B.get(`/api/prod/itemlist/${p.value}`),e=O.value;return(u??[]).filter(t=>!e.has(t.itemId))}catch(u){return console.error(u),[]}},J=u=>{const e=s.value.findIndex(t=>t.itemId===u);e!==-1&&s.value.splice(e,1)},U=F(()=>s.value.map(u=>u.itemId)),O=F(()=>new Set(U.value)),X=u=>{s.value.push({...u,quantity:0})},Y=()=>{if(s.value.length===0){m("생산 지시할 품목을 선택해주세요.","warning");return}if(s.value.some(u=>u.quantity<1)){m("지시 수량을 다시 한번 확인하여 주세요.","warning");return}if(!d.value){m("생산 시작 일자를 선택하여주세요.","warning");return}if(!r.value){m("목표 생산 일자를 선택하여주세요.","warning");return}k.value=!0},Z=async()=>{const u=s.value.map(e=>({item_id:String(e.itemId),goal_qty:Number(e.quantity)}));k.value=!1;try{const{data:e}=await B.post("api/prod/instructions",{itemType:p.value,goalDate:f(r.value,"-"),startDate:f(d.value,"-"),remark:x.value,details:u});e.affectedRows>0?(s.value=[],d.value=null,r.value=null,x.value=null,m("성공적으로 생산 지시하였습니다.","success")):m("생산 지시 중 문제가 발생하였습니다. 공정흐름도를 확인하여 주세요.","error")}catch(e){console.error(e),m("생산 지시 중 문제가 발생하였습니다.","error")}};return(u,e)=>(v(),V(N,null,[a(A,null,{default:n(()=>[a(L,{cols:"9"},{default:n(()=>[a(D,{elevation:"10"},{default:n(()=>[a(M,{class:"py-6 px-6"},{default:n(()=>[a(j,{fluid:""},{default:n(()=>[a(ee,{title:"생산 지시","btn-icon":"mdi-plus-circle","btn-text":"생산 계획 불러오기","btn-variant":"outlined","btn-color":"primary",onBtnClick:()=>{}}),a(ue,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),mandatory:"","selected-class":"active"},{default:n(()=>[(v(!0),V(N,null,_(S.value,t=>(v(),de(me,{key:t.value,value:t.value,label:"",pill:"",variant:"outlined",size:"small"},{default:n(()=>[c(o(t.key),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),a(q,{class:"fixed-table mt-4"},{default:n(()=>[e[15]||(e[15]=l("thead",null,[l("tr",null,[l("th",{class:"text-center"},"품목 번호"),l("th",{class:"text-center"},"품목 유형"),l("th",{class:"text-center"},"품목명"),l("th",{class:"text-center"},"규격"),l("th",{class:"text-center"},"지시 수량"),l("th",{class:"text-center"},"삭제")])],-1)),l("tbody",null,[(v(!0),V(N,null,_(s.value,t=>(v(),V("tr",{key:t.itemId},[l("td",ve,o(t.itemId),1),l("td",ce,o(t.itemType),1),l("td",fe,o(t.itemName),1),l("td",pe,o(t.spec),1),l("td",ye,[a($,{"model-value":T(t.quantity),"onUpdate:modelValue":y=>W(t,y),type:"text",inputmode:"numeric",variant:"outlined","hide-details":"",density:"compact",class:"qty-input"},{"append-inner":n(()=>[l("span",Ve,o(t.unit||""),1)]),_:2},1032,["model-value","onUpdate:modelValue"])]),l("td",be,[a(g,{color:"error",size:"small",onClick:y=>J(t.itemId)},{default:n(()=>[a(G,null,{default:n(()=>e[14]||(e[14]=[c("mdi-delete")])),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1}),a(A,{justify:"center",class:"my-4"},{default:n(()=>[a(g,{"append-icon":"mdi-plus-circle",variant:"outlined",color:"primary",onClick:e[1]||(e[1]=t=>C.value=!0)},{default:n(()=>e[16]||(e[16]=[c(" 품목 추가 ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(L,{cols:"3"},{default:n(()=>[a(D,{elevation:"10"},{default:n(()=>[a(M,{class:"py-6 px-6"},{default:n(()=>[a(j,{fluid:""},{default:n(()=>[a(Q,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=t=>w.value=t),"close-on-content-click":!1,transition:"scale-transition"},{activator:n(({props:t})=>[a($,E(t,{"model-value":b(f)(d.value,"-"),label:"생산 시작 일자","append-inner-icon":"mdi-calendar",readonly:"",variant:"outlined",density:"compact",clearable:"","onClick:clear":e[2]||(e[2]=y=>d.value=null)}),null,16,["model-value"])]),default:n(()=>[a(R,{modelValue:d.value,"onUpdate:modelValue":[e[3]||(e[3]=t=>d.value=t),e[4]||(e[4]=t=>w.value=!1)],min:b(P)(),max:r.value},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"]),a(Q,{modelValue:I.value,"onUpdate:modelValue":e[9]||(e[9]=t=>I.value=t),"close-on-content-click":!1,transition:"scale-transition"},{activator:n(({props:t})=>[a($,E(t,{"model-value":b(f)(r.value,"-"),label:"목표 생산 일자","append-inner-icon":"mdi-calendar",readonly:"",variant:"outlined",density:"compact",clearable:"","onClick:clear":e[6]||(e[6]=y=>r.value=null)}),null,16,["model-value"])]),default:n(()=>[a(R,{modelValue:r.value,"onUpdate:modelValue":[e[7]||(e[7]=t=>r.value=t),e[8]||(e[8]=t=>I.value=!1)],min:d.value||b(P)()},null,8,["modelValue","min"])]),_:1},8,["modelValue"]),a(oe,{modelValue:x.value,"onUpdate:modelValue":e[10]||(e[10]=t=>x.value=t),label:"비고",variant:"outlined",density:"compact","auto-grow":"",rows:"3",clearable:""},null,8,["modelValue"]),a(g,{color:"primary",block:"",onClick:Y},{default:n(()=>e[17]||(e[17]=[c("생산 지시")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(re,{modelValue:k.value,"onUpdate:modelValue":e[12]||(e[12]=t=>k.value=t),"max-width":"600"},{default:n(()=>[a(D,{class:"pa-4 rounded-xl"},{default:n(()=>[l("div",xe,[a(se,{size:"48",color:"grey-lighten-4"},{default:n(()=>[a(G,{size:"28",color:"primary"},{default:n(()=>e[18]||(e[18]=[c("mdi-alert-circle-outline")])),_:1})]),_:1}),e[19]||(e[19]=l("h3",{class:"text-h6 font-weight-bold mt-2"},"등록하시겠습니까?",-1))]),a(q,{density:"comfortable",class:"mb-4"},{default:n(()=>{var t;return[l("tbody",null,[l("tr",null,[e[20]||(e[20]=l("td",null,"생산 유형",-1)),l("td",null,o((t=S.value.find(y=>y.value===p.value))==null?void 0:t.key),1)]),l("tr",null,[e[21]||(e[21]=l("td",null,"생산 시작 일자",-1)),l("td",null,o(b(f)(d.value,"-")),1)]),l("tr",null,[e[22]||(e[22]=l("td",null,"목표 생산 일자",-1)),l("td",null,o(b(f)(r.value,"-")),1)]),l("tr",null,[e[23]||(e[23]=l("td",null,"비고",-1)),l("td",null,o(x.value||"-"),1)])])]}),_:1}),a(q,{density:"compact",class:"mb-4"},{default:n(()=>[e[24]||(e[24]=l("thead",null,[l("tr",null,[l("th",null,"품목 번호"),l("th",null,"품목명"),l("th",null,"지시 수량")])],-1)),l("tbody",null,[(v(!0),V(N,null,_(s.value,t=>(v(),V("tr",{key:t.itemId},[l("td",null,o(t.itemId),1),l("td",null,o(t.itemName),1),l("td",null,o(T(t.quantity))+" "+o(t.unit),1)]))),128))])]),_:1}),a(ie,{class:"justify-end"},{default:n(()=>[a(g,{variant:"tonal",color:"grey-darken-1",onClick:e[11]||(e[11]=t=>k.value=!1)},{default:n(()=>e[25]||(e[25]=[c("취소")])),_:1}),a(g,{color:"primary",onClick:Z},{default:n(()=>e[26]||(e[26]=[c("확인")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(h,{visible:C.value,title:"품목 검색",idField:"itemId",columns:[{key:"itemId",label:"품목 번호"},{key:"itemType",label:"품목 유형"},{key:"itemName",label:"품목명"}],fetchData:H,"exclude-ids":U.value,"page-size":5,onSelect:X,onClose:e[13]||(e[13]=t=>C.value=!1)},null,8,["visible","exclude-ids"]),a(le)],64))}},Pe=ne(ke,[["__scopeId","data-v-757730b8"]]);export{Pe as default};
