import{r,m as Z,D as w,c as ee,o as ae,b as l,w as s,N as _,Q as M,U as o,T as k,ac as v,aj as g,a as A,u as m,aq as le,ar as R,d as F,t as ne,V as te,an as se,F as de,c0 as j}from"./index-BkcQ_3tW.js";import{_ as E}from"./CommonModal-eUFOkW9R.js";import{a as N}from"./index-NIGUFBhG.js";import{_ as ie}from"./card-header-btn3k-B0xKRUFF.js";import{_ as oe}from"./card-header-btn2k-BsHGyKI1.js";import{s as ue,a as p}from"./index-C6cMUqqj.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={class:"card"},me={style:{display:"flex","align-items":"center",gap:"16px","margin-top":"-16px"}},pe={__name:"vendor",setup(ce){const $=r([]);Z(()=>{V()});const u=r({vendId:"",vendName:"",vendType:"",psch:""}),t=r({id:null,vendName:"",bizNumber:"",cntinfo:"",vendType:"",useYn:"",address:"",psch:"",remark:""}),h=r(!1),b=r(!1),y=r(!1),U=r("search"),z=async()=>{var e,a;h.value=!1,b.value=!1,y.value=!1,await j(),(a=(e=document.activeElement)==null?void 0:e.blur)==null||a.call(e)},T=async(e,a)=>{await z(),U.value=a,e==="vendId"?h.value=!0:e==="vendType"?b.value=!0:e==="psch"&&(y.value=!0)};async function L(){var e;(e=window.daum)!=null&&e.Postcode||await new Promise((a,n)=>{const i=document.createElement("script");i.src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js",i.onload=a,document.head.appendChild(i)}),new window.daum.Postcode({oncomplete:a=>{const n=a.userSelectedType==="R"?a.roadAddress:a.jibunAddress,i=prompt("상세주소를 입력하세요","")||"";t.value.address=i?`${n} ${i}`:n}}).open()}const O=e=>{const a=(e==null?void 0:e.vend_type)||(e==null?void 0:e.vendType)||"";U.value==="create"?t.value.vendType=a:u.value.vendType=a,b.value=!1},q=e=>{const a=(e==null?void 0:e.emp_name)||(e==null?void 0:e.empName)||"";U.value==="create"?t.value.psch=a:u.value.psch=a,y.value=!1},P=async(e,a,n,i)=>{try{const{data:d}=await N.get(e,{params:{q:a,page:n,size:i}});return Array.isArray(d)?d:d.items??[]}catch(d){return console.error("모달 조회 실패",e,d),[]}},V=async()=>{const{data:e}=await N.post("/api/vendor/search",{...u.value});$.value=Array.isArray(e)?e:e.items??[]},G=async()=>{u.value={vendId:"",vendName:"",vendType:""},await j(),await V()},C=r(null);function H(){t.value={id:null,vendName:"",bizNumber:"",cntinfo:"",vendType:"",useYn:"",address:"",psch:"",remark:""}}w(C,e=>{if(!e)return H();t.value={id:(e==null?void 0:e.vendId)??null,vendName:(e==null?void 0:e.vendName)??"",bizNumber:(e==null?void 0:e.bizNumber)??"",cntinfo:(e==null?void 0:e.cntinfo)??"",vendType:(e==null?void 0:e.vendType)??"",useYn:(e==null?void 0:e.useYn)??"",address:(e==null?void 0:e.address)??"",psch:(e==null?void 0:e.psch)??"",remark:(e==null?void 0:e.remark)??(e==null?void 0:e.remk)??""}});const K=e=>!!(e.vendName&&e.bizNumber&&e.cntinfo&&e.vendType&&e.address),x=r(!1),S=r(""),Y=r("success"),c=(e,a="success")=>{S.value=e,Y.value=a,x.value=!0},Q=()=>({vendName:t.value.vendName,bizNumber:t.value.bizNumber,cntinfo:t.value.cntinfo,vendType:t.value.vendType,useYn:t.value.useYn??"Y",address:t.value.address,psch:t.value.psch,remark:t.value.remark??null}),J=async()=>{var n,i,d;const e=!!t.value.id;if(!K(t.value))return c("필수 값을 확인하세요.","warning");const a=Q();if(!(!e&&!window.confirm("등록하시겠습니까?")))try{e?(await N.put(`/api/vendor/${encodeURIComponent(t.value.id)}`,a),c("수정이 완료되었습니다.","success")):(await N.post("/api/vendor",a),c("등록이 완료되었습니다.","success"),await I()),await V()}catch(f){const B=(n=f==null?void 0:f.response)==null?void 0:n.status,D=(d=(i=f==null?void 0:f.response)==null?void 0:i.data)==null?void 0:d.message;c(B===409?D||"이미 등록된 거래처입니다!":D||(e?"수정 중 오류가 발생했습니다.":"등록 중 오류가 발생했습니다."),B===409?"warning":"error")}},I=async()=>{t.value={id:null,vendName:"",bizNumber:"",cntinfo:"",vendType:"",useYn:"",address:"",psch:"",remark:""},await z()},W=async()=>{var a,n,i;const e=(a=C.value)==null?void 0:a.vendId;if(!e)return c("삭제할 거래처를 선택해주세요.","warning");if(confirm("삭제하시겠습니까?"))try{const{data:d}=await N.delete("/api/vendDelete",{data:{vend_id:e}});if(!(d!=null&&d.result))return c((d==null?void 0:d.message)||"삭제에 실패했습니다.","warning");c("삭제되었습니다.","success"),await V(),I()}catch(d){c(((i=(n=d==null?void 0:d.response)==null?void 0:n.data)==null?void 0:i.message)||"삭제 중 오류가 발생했습니다.","error")}},X=e=>{const a=String(e??"").replace(/\D/g,"").slice(0,10);return a.length<=3?a:a.length<=5?`${a.slice(0,3)}-${a.slice(3)}`:`${a.slice(0,3)}-${a.slice(3,5)}-${a.slice(5)}`};return(e,a)=>(ae(),ee(de,null,[l(k,null,{default:s(()=>[l(_,{elevation:"10",class:"pa-6"},{default:s(()=>[l(M,{class:"py-6 px-6"},{default:s(()=>[l(oe,{title:"거래처 관리","btn-text2":"조회","btn-color2":"primary","btn-variant2":"flat",onBtnClick2:V,"btn-text1":"초기화","btn-color1":"secondary","btn-variant1":"flat",onBtnClick1:G})]),_:1}),l(o,{cols:"12",md:"12"},{default:s(()=>[l(k,{dense:""},{default:s(()=>[l(o,{cols:"12",sm:"4"},{default:s(()=>[l(v,{variant:"outlined",label:"거래처번호",modelValue:u.value.vendId,"onUpdate:modelValue":a[0]||(a[0]=n=>u.value.vendId=n)},null,8,["modelValue"])]),_:1}),l(o,{cols:"12",sm:"4"},{default:s(()=>[l(v,{variant:"outlined",label:"거래처명",modelValue:u.value.vendName,"onUpdate:modelValue":a[1]||(a[1]=n=>u.value.vendName=n)},null,8,["modelValue"])]),_:1}),l(o,{cols:"12",sm:"4"},{default:s(()=>[l(v,{variant:"outlined",label:"거래처유형",modelValue:u.value.vendType,"onUpdate:modelValue":a[2]||(a[2]=n=>u.value.vendType=n),"append-inner-icon":"mdi-magnify","onClick:appendInner":a[3]||(a[3]=g(n=>T("vendType","search"),["stop"]))},null,8,["modelValue"])]),_:1}),l(o,{cols:"12",sm:"4"},{default:s(()=>[l(v,{variant:"outlined",label:"담당자",modelValue:u.value.psch,"onUpdate:modelValue":a[4]||(a[4]=n=>u.value.psch=n),"append-inner-icon":"mdi-magnify","onClick:appendInner":a[5]||(a[5]=g(n=>T("psch","search"),["stop"]))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(k,null,{default:s(()=>[l(_,{elevation:"10",class:"pa-6 mt-2"},{default:s(()=>[l(o,{cols:"12"},{default:s(()=>[A("div",ve,[l(m(ue),{value:$.value,selection:C.value,"onUpdate:selection":a[6]||(a[6]=n=>C.value=n),selectionMode:"single",dataKey:"vendId",tableStyle:"min-width: 50rem",rowHover:"",paginator:!0,rows:5,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"RowsPerPageDropdown PrevPageLink PageLinks NextPageLink"},{default:s(()=>[l(m(p),{field:"vendId",sortable:"",header:"거래처번호"}),l(m(p),{field:"vendName",header:"거래처명"}),l(m(p),{field:"bizNumber",header:"사업자번호"}),l(m(p),{field:"cntinfo",header:"연락처"}),l(m(p),{field:"vendType",header:"거래처유형"}),l(m(p),{field:"useYn",header:"사용여부"}),l(m(p),{field:"address",header:"주소"}),l(m(p),{field:"psch",header:"담당자"}),l(m(p),{field:"remark",header:"비고"})]),_:1},8,["value","selection"])])]),_:1})]),_:1})]),_:1}),l(k,null,{default:s(()=>[l(_,{elevation:"10",class:"pa-6 mt-2"},{default:s(()=>[l(M,{class:"py-6 px-6"},{default:s(()=>[l(ie,{title:"거래처 등록","btn-text3":"저장","btn-color3":"warning","btn-variant3":"flat",onBtnClick3:m(J),"btn-text2":"삭제","btn-color2":"error","btn-variant2":"flat","btn-disabled2":!t.value.id,onBtnClick2:W,"btn-text1":"초기화","btn-color1":"secondary","btn-variant1":"flat",onBtnClick1:I},null,8,["onBtnClick3","btn-disabled2"])]),_:1}),l(o,{cols:"12",md:"12"},{default:s(()=>[l(k,{dense:""},{default:s(()=>[l(o,{cols:"12",sm:"4"},{default:s(()=>[l(v,{variant:"outlined",label:"거래처명",modelValue:t.value.vendName,"onUpdate:modelValue":a[7]||(a[7]=n=>t.value.vendName=n)},null,8,["modelValue"])]),_:1}),l(o,{cols:"12",sm:"4"},{default:s(()=>[l(v,{variant:"outlined",label:"사업자번호",modelValue:t.value.bizNumber,"onUpdate:modelValue":[a[8]||(a[8]=n=>t.value.bizNumber=n),a[9]||(a[9]=n=>t.value.bizNumber=X(n))]},null,8,["modelValue"])]),_:1}),l(o,{cols:"12",sm:"4"},{default:s(()=>[l(v,{variant:"outlined",label:"연락처",modelValue:t.value.cntinfo,"onUpdate:modelValue":a[10]||(a[10]=n=>t.value.cntinfo=n)},null,8,["modelValue"])]),_:1}),l(o,{cols:"12",sm:"4"},{default:s(()=>[l(v,{variant:"outlined",label:"거래처유형",modelValue:t.value.vendType,"onUpdate:modelValue":a[11]||(a[11]=n=>t.value.vendType=n),"append-inner-icon":"mdi-magnify","onClick:appendInner":a[12]||(a[12]=g(n=>T("vendType","create"),["stop"])),readonly:""},null,8,["modelValue"])]),_:1}),l(o,{cols:"12",sm:"4"},{default:s(()=>[l(le,{modelValue:t.value.useYn,"onUpdate:modelValue":a[13]||(a[13]=n=>t.value.useYn=n),label:"사용여부",variant:"outlined",style:{width:"100%","--v-input-gap":"4px"}},{default:s(()=>[A("div",me,[l(R,{label:"사용",value:"Y"}),l(R,{label:"미사용",value:"N"})])]),_:1},8,["modelValue"])]),_:1}),l(o,{cols:"12",sm:"4"},{default:s(()=>[l(v,{variant:"outlined",label:"담당자",modelValue:t.value.psch,"onUpdate:modelValue":a[14]||(a[14]=n=>t.value.psch=n),"append-inner-icon":"mdi-magnify","onClick:appendInner":a[15]||(a[15]=g(n=>T("psch","create"),["stop"])),readonly:""},null,8,["modelValue"])]),_:1}),l(o,{cols:"12",sm:"4"},{default:s(()=>[l(v,{variant:"outlined",label:"주소",modelValue:t.value.address,"onUpdate:modelValue":a[16]||(a[16]=n=>t.value.address=n),"append-inner-icon":"mdi-magnify","onClick:appendInner":g(L,["stop"]),readonly:""},null,8,["modelValue"])]),_:1}),l(o,{cols:"12",sm:"4"},{default:s(()=>[l(v,{variant:"outlined",label:"비고",modelValue:t.value.remark,"onUpdate:modelValue":a[17]||(a[17]=n=>t.value.remark=n)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(se,{modelValue:x.value,"onUpdate:modelValue":a[19]||(a[19]=n=>x.value=n),timeout:2e3,color:Y.value,location:"top right",rounded:"pill"},{actions:s(()=>[l(te,{variant:"text",onClick:a[18]||(a[18]=n=>x.value=!1)},{default:s(()=>a[22]||(a[22]=[F("닫기")])),_:1})]),default:s(()=>[F(ne(S.value)+" ",1)]),_:1},8,["modelValue","color"]),l(E,{visible:b.value,"onUpdate:visible":a[20]||(a[20]=n=>b.value=n),title:"거래처유형 검색",idField:"vend_type",columns:[{key:"type_id",label:"유형번호"},{key:"vend_type",label:"거래처유형"}],fetchData:(n,i,d)=>P("/api/vendorType",n,i,d),pageSize:10,onSelect:O},null,8,["visible","fetchData"]),l(E,{visible:y.value,"onUpdate:visible":a[21]||(a[21]=n=>y.value=n),title:"사원 검색",idField:"emp_id",columns:[{key:"emp_id",label:"사원번호"},{key:"emp_name",label:"사원명"}],fetchData:(n,i,d)=>P("/api/vendorPsch",n,i,d),pageSize:5,onSelect:q},null,8,["visible","fetchData"])],64))}},Ce=re(pe,[["__scopeId","data-v-f2156b3c"]]);export{Ce as default};
