import{B as O,r as i,M as _,ao as Q,D as G,c as J,b as l,w as n,N as D,T as N,af as W,F as X,o as Z,Q as h,U as d,y as ee,ai as ae,aj as le,ac as m,x as B,ap as A,u as M,s as R,V as x,d as c,ak as j,a as L,t as te,O as ne,a2 as oe,a6 as ie}from"./index-vUQOwfGq.js";import{_ as ue}from"./card-header-btn2-3eeFV3jL.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de=O({__name:"Status",setup(re){const v=i(!1),F=new Date,t=i({facilityId:null,facilityName:"",cleaningItem:"",manager:"",dateFrom:null,dateTo:null}),p=i(!1),g=i(!1),I=o=>o?`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`:"",y=_(()=>I(t.value.dateFrom)),V=_(()=>I(t.value.dateTo)),q=o=>o?o.slice(0,10):"",z=[{title:"일자",value:"cleaning_date",width:120},{title:"설비명",value:"facility_name",width:200},{title:"세척 항목",value:"item_name"},{title:"담당자",value:"manager_name",width:120},{title:"방법",value:"method_desc",width:160},{title:"결과/비고",value:"result_note"}],T=i([]),k=i(0),f=i(1),w=i(10);async function s(){if(t.value.dateFrom&&t.value.dateTo&&t.value.dateFrom>t.value.dateTo){alert("종료일은 시작일보다 빠를 수 없습니다.");return}v.value=!0;try{const o=new URLSearchParams({page:String(f.value),size:String(w.value)});t.value.facilityId&&o.set("facilityId",String(t.value.facilityId)),t.value.cleaningItem&&o.set("cleaningItem",t.value.cleaningItem),t.value.manager&&o.set("manager",t.value.manager),y.value&&o.set("dateFrom",y.value),V.value&&o.set("dateTo",V.value);const u=await(await fetch(`api/clean-hist?${o.toString()}`)).json();T.value=u.items||[],k.value=u.total||0}catch(o){console.error(o)}finally{v.value=!1}}function U(){t.value={facilityId:null,facilityName:"",cleaningItem:"",manager:"",dateFrom:null,dateTo:null},f.value=1,s()}const r=i(!1),b=i(""),$=i([]),C=i(!1),E=[{title:"코드",value:"facility_code",width:140},{title:"설비명",value:"facility_name"},{title:"유형",value:"type",width:120}];async function S(){var o;try{C.value=!0;const e=((o=b.value)==null?void 0:o.trim())||"",a=await(await fetch(`api/facilities?query=${encodeURIComponent(e)}`)).json();$.value=Array.isArray(a)?a:a.items||[]}finally{C.value=!1}}let P;const K=()=>{clearTimeout(P),P=setTimeout(S,250)};function Y(o,e){const u=e.item;t.value.facilityId=u.facility_id,t.value.facilityName=u.facility_name,r.value=!1}return Q(()=>{r.value&&S()}),G(()=>t.value.dateFrom,o=>{const e=t.value.dateTo;o&&e&&e<o&&(t.value.dateTo=o)}),s(),(o,e)=>{const u=ee("UiParentCard");return Z(),J(X,null,[l(D,{elevation:"10"},{default:n(()=>[l(h,{class:"py-6 px-6"},{default:n(()=>[l(ue,{title:"설비 상태","btn-text1":"초기화","btn-variant1":"flat","btn-color1":"grey",onBtnClick1:U,"btn-text2":"조회","btn-variant2":"flat","btn-color2":"primary",onBtnClick2:s,loading:v.value},null,8,["loading"])]),_:1})]),_:1}),l(N,null,{default:n(()=>[l(d,{cols:"12"},{default:n(()=>[l(u,{title:"설비상태"},{default:n(()=>[l(ae,{onSubmit:le(s,["prevent"])},{default:n(()=>[l(N,{dense:""},{default:n(()=>[l(d,{cols:"12",sm:"3"},{default:n(()=>[l(m,{label:"설비명",variant:"outlined",readonly:"",value:t.value.facilityName,placeholder:"설비 선택",onClick:e[0]||(e[0]=a=>r.value=!0),"prepend-inner-icon":"mdi-magnify"},null,8,["value"])]),_:1}),l(d,{cols:"12",sm:"3"},{default:n(()=>[l(m,{modelValue:t.value.cleaningItem,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.cleaningItem=a),label:"세척 항목",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(d,{cols:"12",sm:"3"},{default:n(()=>[l(m,{modelValue:t.value.manager,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.manager=a),label:"담당자",variant:"outlined"},null,8,["modelValue"])]),_:1}),l(d,{cols:"12",sm:"3"},{default:n(()=>[l(B,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=a=>p.value=a),"close-on-content-click":!1,location:"bottom start",offset:8,"min-width":"auto"},{activator:n(({props:a})=>[l(m,R(a,{"model-value":y.value,label:"세척 일자","prepend-inner-icon":"mdi-calendar",readonly:"",variant:"outlined",clearable:"","onClick:clear":e[3]||(e[3]=H=>t.value.dateFrom=null)}),null,16,["model-value"])]),default:n(()=>[l(A,{modelValue:t.value.dateFrom,"onUpdate:modelValue":[e[4]||(e[4]=a=>t.value.dateFrom=a),e[5]||(e[5]=a=>p.value=!1)],locale:"ko-KR",max:M(F)},null,8,["modelValue","max"])]),_:1},8,["modelValue"])]),_:1}),l(d,{cols:"12",sm:"3"},{default:n(()=>[l(B,{modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=a=>g.value=a),"close-on-content-click":!1,location:"bottom start",offset:8,"min-width":"auto"},{activator:n(({props:a})=>[l(m,R(a,{"model-value":V.value,label:"종료일","prepend-inner-icon":"mdi-calendar",readonly:"",variant:"outlined",clearable:"","onClick:clear":e[7]||(e[7]=H=>t.value.dateTo=null)}),null,16,["model-value"])]),default:n(()=>[l(A,{modelValue:t.value.dateTo,"onUpdate:modelValue":[e[8]||(e[8]=a=>t.value.dateTo=a),e[9]||(e[9]=a=>g.value=!1)],locale:"ko-KR",min:t.value.dateFrom||void 0,max:M(F)},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"])]),_:1}),l(d,{cols:"12",sm:"3",class:"d-flex align-end"},{default:n(()=>[l(x,{loading:v.value,color:"primary",onClick:s},{default:n(()=>e[17]||(e[17]=[c("조회")])),_:1},8,["loading"]),l(x,{class:"ml-2",variant:"outlined",onClick:U},{default:n(()=>e[18]||(e[18]=[c("초기화")])),_:1})]),_:1})]),_:1})]),_:1}),l(j,{class:"mt-6",headers:z,items:T.value,loading:v.value,page:f.value,"items-per-page":w.value,"server-items-length":k.value,"onUpdate:page":e[11]||(e[11]=a=>{f.value=a,s()}),"onUpdate:itemsPerPage":e[12]||(e[12]=a=>{w.value=a,f.value=1,s()})},{"item.cleaning_date":n(({item:a})=>[c(te(q(a.cleaning_date)),1)]),loading:n(()=>e[19]||(e[19]=[L("div",{class:"pa-6 text-center"},"불러오는 중…",-1)])),"no-data":n(()=>e[20]||(e[20]=[L("div",{class:"pa-6 text-center"},"데이터가 없습니다.",-1)])),_:1},8,["items","loading","page","items-per-page","server-items-length"])]),_:1})]),_:1})]),_:1}),l(W,{modelValue:r.value,"onUpdate:modelValue":e[16]||(e[16]=a=>r.value=a),"max-width":"800"},{default:n(()=>[l(D,null,{default:n(()=>[l(ne,null,{default:n(()=>e[21]||(e[21]=[c("설비 선택")])),_:1}),l(oe,null,{default:n(()=>[l(m,{modelValue:b.value,"onUpdate:modelValue":e[13]||(e[13]=a=>b.value=a),variant:"outlined",density:"compact",placeholder:"설비명/코드 검색","prepend-inner-icon":"mdi-magnify",onInput:e[14]||(e[14]=a=>K())},null,8,["modelValue"]),l(j,{headers:E,items:$.value,loading:C.value,"item-key":"facility_id",class:"mt-2 clickable-rows","onClick:row":Y},null,8,["items","loading"])]),_:1}),l(ie,{class:"justify-end"},{default:n(()=>[l(x,{variant:"text",onClick:e[15]||(e[15]=a=>r.value=!1)},{default:n(()=>e[22]||(e[22]=[c("닫기")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}}),pe=se(de,[["__scopeId","data-v-81b2e811"]]);export{pe as default};
