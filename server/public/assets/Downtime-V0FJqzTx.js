import{a as w}from"./index-NIGUFBhG.js";import{_ as be}from"./card-header-btn2-BNncrG3u.js";import{_ as ge}from"./card-header-btn3k-B0xKRUFF.js";import{s as ke,a as m}from"./index-C6cMUqqj.js";import{_ as J}from"./CommonModal-eUFOkW9R.js";import{u as De}from"./useSnackBar-CsLaRa2S.js";import{u as $e}from"./useFormatDate-DuO0KNBS.js";import{M as Ce,r as o,D as Se,c as oe,o as P,b as l,w as n,Q as W,T as g,U as i,ac as v,a0 as k,d as f,u as s,N as X,i as ue,y as xe,h as Te,t as de,e as Ue,aq as Ie,ar as ie,al as se,am as Fe,an as Ne,F as Me}from"./index-BkcQ_3tW.js";const Re={key:0,class:"text-grey mt-3"},ze={__name:"Downtime",setup(Be){const{formatDate:Z}=$e(),{snackOpen:H,snackMessage:h,snackColor:ee}=De(),r=(a,e="success")=>{h.value=a,ee.value=e,H.value=!0},le=new Date().toISOString().split("T")[0],ae=Ce(()=>{const a=new Date,e=u=>String(u).padStart(2,"0");return`${a.getFullYear()}-${e(a.getMonth()+1)}-${e(a.getDate())}T${e(a.getHours())}:${e(a.getMinutes())}`}),L=o(!1),E=o(!1),K=o(!1),O=o(""),D=o(""),j=o(""),$=o(""),q=o(""),C=o(""),p=o(null),c=o(null),z=o([]),V=o(null),d=o(""),S=o(""),x=o(""),T=o(""),U=o(""),I=o(""),F=o(""),y=o(""),_=o(""),N=o("N"),M=o(""),b=o(""),R=o(!1),B=o(!1),Y=o(!1),re=async()=>(await w.get("/api/facilities")).data,ve=async()=>(await w.get("/api/users")).data,me=async()=>(await w.get("/api/downTypes")).data;function fe(a){S.value=a.facility_id,x.value=a.facility_name,O.value=a.facility_id,D.value=a.facility_name,R.value=!1}function pe(a){T.value=a.user_id,U.value=a.user_name,j.value=a.user_id,$.value=a.user_name,B.value=!1}function ce(a){I.value=a.down_type_id,F.value=a.down_type_name,q.value=a.down_type_id,C.value=a.down_type_name,Y.value=!1}function te(a){if(!a)return"";const e=new Date(a),u=t=>String(t).padStart(2,"0");return`${e.getFullYear()}-${u(e.getMonth()+1)}-${u(e.getDate())} ${u(e.getHours())}:${u(e.getMinutes())}:${u(e.getSeconds())}`}function ye(a,e){const u=new Date(a),t=new Date(e);return Math.max(0,Math.round((t-u)/6e4))}async function Q(){try{if(p.value&&c.value&&p.value>c.value){r("시작일이 종료일보다 클 수 없습니다","error");return}L.value=!0;const a={facility_id:O.value||null,emp_id:j.value||null,down_type_id:q.value||null,from_dt:p.value?`${Z(p.value,"-")} 00:00:00`:null,to_dt:c.value?`${Z(c.value,"-")} 23:59:59`:null},{data:e}=await w.get("/api/downtimeList",{params:a});z.value=(e||[]).map(u=>({...u,duration_min:u.down_start_dt&&u.down_end_dt?ye(u.down_start_dt,u.down_end_dt):null,oper_yn:u.oper_yn??"N"}))}catch(a){console.error(a),r("비가동 조회 실패","error")}finally{L.value=!1}}function _e(){O.value="",D.value="",j.value="",$.value="",q.value="",C.value="",p.value=null,c.value=null,z.value=[],V.value=null}Se(V,a=>{a&&(d.value=a.down_id||"",S.value=a.facility_id||"",x.value=a.facility_name||"",T.value=a.emp_id||"",U.value=a.emp_name||"",I.value=a.down_type_id||"",F.value=a.down_type_name||"",y.value=a.down_start_dt?a.down_start_dt.replace(" ","T").slice(0,16):"",_.value=a.down_end_dt?a.down_end_dt.replace(" ","T").slice(0,16):"",N.value=a.oper_yn??"N",M.value=a.remk||"",b.value="")});function A(){d.value="",S.value=O.value,x.value=D.value,T.value=j.value,U.value=$.value,I.value=q.value,F.value=C.value;const a=new Date,e=t=>String(t).padStart(2,"0"),u=`${a.getFullYear()}-${e(a.getMonth()+1)}-${e(a.getDate())}T${e(a.getHours())}:${e(a.getMinutes())}`;y.value=u,_.value=u,N.value="N",M.value="",b.value="",V.value=null}async function we(){var t,ne;if(!S.value||!T.value||!I.value||!y.value||!_.value){r("필수값을 입력하세요","error");return}const a=new Date(y.value);if(new Date(_.value)<a)return r("종료일시는 시작일시 이후여야 합니다","error");const u={down_id:d.value||null,facility_id:S.value,emp_id:T.value,down_type_id:I.value,down_start_dt:te(y.value),down_end_dt:te(_.value),oper_yn:N.value,remk:M.value,edit_reason:d.value&&b.value||null};if(confirm(d.value?"정말 정정(수정)하시겠습니까?":"정말 등록하시겠습니까?")&&!E.value){E.value=!0;try{const G=d.value?await w.put("/api/downtimeUpdate",u):await w.post("/api/downtimeInsert",u);(t=G.data)!=null&&t.success?(r(d.value?"정정되었습니다":"등록되었습니다",d.value?"warning":"success"),await Q(),A()):r(((ne=G.data)==null?void 0:ne.error)||"저장 실패","error")}catch(G){console.error(G),r("저장 실패","error")}finally{E.value=!1}}}async function Ve(){if(!d.value)return r("무효 처리할 건을 선택하세요","warning");if(confirm("정말 무효 처리하시겠습니까?")&&!K.value){K.value=!0;try{const{data:a}=await w.patch("/api/downtimeVoid",{down_id:d.value,edit_reason:b.value||null});a!=null&&a.success?(r("무효 처리되었습니다","error"),await Q(),A()):r((a==null?void 0:a.error)||"무효 처리 실패","error")}catch(a){console.error(a),r("무효 처리 실패","error")}finally{K.value=!1}}}return(a,e)=>{const u=xe("CardHeader");return P(),oe(Me,null,[l(X,{elevation:"10"},{default:n(()=>[l(W,{class:"py-6 px-6"},{default:n(()=>[l(be,{title:"비가동 조회","btn-text1":"초기화","btn-variant1":"flat","btn-color1":"secondary",onBtnClick1:_e,"btn-text2":"조회","btn-variant2":"flat","btn-color2":"primary",onBtnClick2:Q}),l(g,null,{default:n(()=>[l(i,{cols:"12",md:"12"},{default:n(()=>[l(g,{justify:"space-between",dense:""},{default:n(()=>[l(i,{cols:"12",sm:"3"},{default:n(()=>[l(v,{label:"설비명",modelValue:D.value,"onUpdate:modelValue":e[1]||(e[1]=t=>D.value=t),variant:"outlined",readonly:""},{"append-inner":n(()=>[l(k,{class:"cursor-pointer",onClick:e[0]||(e[0]=t=>R.value=!0)},{default:n(()=>e[26]||(e[26]=[f("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(i,{cols:"12",sm:"3"},{default:n(()=>[l(v,{label:"담당자",modelValue:$.value,"onUpdate:modelValue":e[3]||(e[3]=t=>$.value=t),variant:"outlined",readonly:""},{"append-inner":n(()=>[l(k,{class:"cursor-pointer",onClick:e[2]||(e[2]=t=>B.value=!0)},{default:n(()=>e[27]||(e[27]=[f("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(i,{cols:"12",sm:"3"},{default:n(()=>[l(v,{label:"비가동 유형",modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=t=>C.value=t),variant:"outlined",readonly:""},{"append-inner":n(()=>[l(k,{class:"cursor-pointer",onClick:e[4]||(e[4]=t=>Y.value=!0)},{default:n(()=>e[28]||(e[28]=[f("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(i,{cols:"12",sm:"3"},{default:n(()=>[l(v,{type:"date",label:"시작일",modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=t=>p.value=t),max:s(le),variant:"outlined"},null,8,["modelValue","max"])]),_:1}),l(i,{cols:"12",sm:"3"},{default:n(()=>[l(v,{type:"date",label:"종료일",modelValue:c.value,"onUpdate:modelValue":e[7]||(e[7]=t=>c.value=t),max:s(le),variant:"outlined"},null,8,["modelValue","max"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(X,{elevation:"10",class:"mt-3"},{default:n(()=>[l(W,{class:"py-6 px-6"},{default:n(()=>[l(u,{title:"비가동 목록"}),l(s(ke),{selection:V.value,"onUpdate:selection":e[8]||(e[8]=t=>V.value=t),value:z.value,selectionMode:"single",metaKeySelection:!1,dataKey:"down_id",paginator:"",rows:10,loading:L.value,tableStyle:"min-width: 64rem",class:"cursor-pointer",onRowDblclick:e[9]||(e[9]=({data:t})=>{V.value=t})},{default:n(()=>[l(s(m),{field:"down_id",header:"ID"}),l(s(m),{field:"facility_name",header:"설비명"}),l(s(m),{field:"emp_name",header:"담당자"}),l(s(m),{field:"down_type_name",header:"비가동 유형"}),l(s(m),{field:"down_start_dt",header:"시작일시"}),l(s(m),{field:"down_end_dt",header:"종료일시"}),l(s(m),{field:"duration_min",header:"소요(분)"}),l(s(m),{header:"상태"},{body:n(({data:t})=>[l(Te,{size:"small",color:t.oper_yn==="Y"?"primary":"grey",variant:"flat"},{default:n(()=>[f(de(t.oper_yn==="Y"?"가동":"비가동"),1)]),_:2},1032,["color"])]),_:1}),l(s(m),{field:"remk",header:"비고"})]),_:1},8,["selection","value","loading"]),!z.value.length&&!L.value?(P(),oe("p",Re,"조회 결과가 없습니다.")):ue("",!0)]),_:1})]),_:1}),l(X,{elevation:"10",class:"mt-3"},{default:n(()=>[l(W,{class:"py-6 px-6"},{default:n(()=>[l(ge,{title:d.value?"비가동 정정":"비가동 등록","btn-text1":"초기화","btn-variant1":"flat","btn-color1":"secondary",onBtnClick1:A,"btn-text2":"무효","btn-variant2":"flat","btn-color2":"error","btn-disabled2":!d.value||K.value,onBtnClick2:Ve,"btn-text3":"저장","btn-variant3":"flat","btn-color3":"primary","btn-disabled3":E.value,onBtnClick3:we},null,8,["title","btn-disabled2","btn-disabled3"]),l(g,{dense:""},{default:n(()=>[l(i,{cols:"12",sm:"4"},{default:n(()=>[l(v,{label:"설비명",modelValue:x.value,"onUpdate:modelValue":e[11]||(e[11]=t=>x.value=t),variant:"outlined",readonly:""},{"append-inner":n(()=>[l(k,{class:"cursor-pointer",onClick:e[10]||(e[10]=t=>R.value=!0)},{default:n(()=>e[29]||(e[29]=[f("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(i,{cols:"12",sm:"4"},{default:n(()=>[l(v,{label:"담당자",modelValue:U.value,"onUpdate:modelValue":e[13]||(e[13]=t=>U.value=t),variant:"outlined",readonly:""},{"append-inner":n(()=>[l(k,{class:"cursor-pointer",onClick:e[12]||(e[12]=t=>B.value=!0)},{default:n(()=>e[30]||(e[30]=[f("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(i,{cols:"12",sm:"4"},{default:n(()=>[l(v,{label:"비가동 유형",modelValue:F.value,"onUpdate:modelValue":e[15]||(e[15]=t=>F.value=t),variant:"outlined",readonly:""},{"append-inner":n(()=>[l(k,{class:"cursor-pointer",onClick:e[14]||(e[14]=t=>Y.value=!0)},{default:n(()=>e[31]||(e[31]=[f("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(g,{dense:""},{default:n(()=>[l(i,{cols:"12",sm:"4"},{default:n(()=>[l(v,{label:"이력ID",modelValue:d.value,"onUpdate:modelValue":e[16]||(e[16]=t=>d.value=t),variant:"outlined",readonly:""},null,8,["modelValue"])]),_:1}),l(i,{cols:"12",sm:"4"},{default:n(()=>[l(v,{type:"datetime-local",label:"비가동 시작",modelValue:y.value,"onUpdate:modelValue":e[17]||(e[17]=t=>y.value=t),max:ae.value,variant:"outlined"},null,8,["modelValue","max"])]),_:1}),l(i,{cols:"12",sm:"4"},{default:n(()=>[l(v,{type:"datetime-local",label:"비가동 종료",modelValue:_.value,"onUpdate:modelValue":e[18]||(e[18]=t=>_.value=t),max:ae.value,variant:"outlined"},null,8,["modelValue","max"])]),_:1})]),_:1}),l(g,{dense:""},{default:n(()=>[l(i,{cols:"12",sm:"6"},{default:n(()=>[l(Ie,{modelValue:N.value,"onUpdate:modelValue":e[19]||(e[19]=t=>N.value=t),inline:""},{default:n(()=>[l(ie,{label:"비가동",value:"N"}),l(ie,{label:"가동",value:"Y"})]),_:1},8,["modelValue"])]),_:1}),l(i,{cols:"12",sm:"6"},{default:n(()=>[l(se,{label:"비고",modelValue:M.value,"onUpdate:modelValue":e[20]||(e[20]=t=>M.value=t),rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),d.value?(P(),Ue(g,{key:0,dense:""},{default:n(()=>[l(i,{cols:"12"},{default:n(()=>[l(se,{label:"정정 사유",modelValue:b.value,"onUpdate:modelValue":e[21]||(e[21]=t=>b.value=t),rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})):ue("",!0)]),_:1})]),_:1}),l(J,{visible:R.value,title:"설비명",idField:"facility_id",columns:[{key:"facility_id",label:"ID"},{key:"facility_name",label:"설비명"}],fetchData:re,onSelect:fe,onClose:e[22]||(e[22]=t=>R.value=!1)},null,8,["visible"]),l(J,{visible:B.value,title:"담당자",idField:"user_id",columns:[{key:"user_id",label:"ID"},{key:"user_name",label:"이름"}],fetchData:ve,onSelect:pe,onClose:e[23]||(e[23]=t=>B.value=!1)},null,8,["visible"]),l(J,{visible:Y.value,title:"비가동 유형",idField:"down_type_id",columns:[{key:"down_type_id",label:"ID"},{key:"down_type_name",label:"유형명"}],fetchData:me,onSelect:ce,onClose:e[24]||(e[24]=t=>Y.value=!1)},null,8,["visible"]),l(Ne,{modelValue:s(H),"onUpdate:modelValue":e[25]||(e[25]=t=>Fe(H)?H.value=t:null),color:s(ee),timeout:"2000",location:"top right"},{default:n(()=>[f(de(s(h)),1)]),_:1},8,["modelValue","color"])],64)}}};export{ze as default};
