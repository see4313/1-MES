import{r as n,bE as te,D as $,M as D,c as p,o as u,b as a,w as l,Q as M,K as U,T as E,U as w,ac as ae,a0 as Q,d as m,a as d,as as K,F as C,z as S,h as v,N as j,u as i,t as c,aj as le,i as q,e as z}from"./index-BkcQ_3tW.js";import{a as F}from"./index-NIGUFBhG.js";import{_ as se}from"./card-header-CLs5wgxG.js";import{s as G,a as r}from"./index-C6cMUqqj.js";import{_ as oe}from"./CommonModal-eUFOkW9R.js";import{u as ie}from"./useFormatDate-DuO0KNBS.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"d-flex flex-column"},ne={class:"d-flex flex-column"},ue={class:"d-flex flex-wrap align-center gap-1"},ce={style:{"font-weight":"bold","margin-left":"2px"}},me={class:"d-flex flex-column"},pe=["onClick","aria-expanded"],he={class:"expansion-panel"},ve={key:0,class:"expansion-loading"},fe={key:1},ye={class:"nowrap"},be={key:0},_e={class:"nowrap"},xe={key:0},ge={__name:"instructionList",setup(we){const{kstFormatDate:k}=ie(),N=n(!1),y=n(""),V=n([]),h=n([]),b=n([]),_=n([]),f=n({}),x=n({}),I=n(new Set);te(()=>{g()});let L;$(y,()=>{clearTimeout(L),L=setTimeout(()=>{g()},300)}),$([b,_,h],()=>{g()},{deep:!0});const g=async()=>{try{const{data:s}=await F.get("/api/prod/instructionlist",{params:{types:b.value,status:_.value,productIds:h.value.map(t=>t.itemId),instructionNo:(y.value||"").trim()}});V.value=s.map(t=>({...t,instructionDatetimeFormatted:k(t.instructDatetime),startDatetimeFormatted:k(t.startDatetime),goalDatetimeFormatted:k(t.goalDatetime)}))}catch(s){console.error(s),V.value=[]}},A=async s=>{const t=s.instructNo;if(!x.value[t]){I.value.add(t);try{const{data:e}=await F.get("/api/prod/detailinstruction",{params:{instructNo:t}});x.value[t]=e}catch(e){console.error(e),x.value[t]=[]}finally{I.value.delete(t)}}},H=n([{key:"반제품",value:"semi"},{key:"완제품",value:"finish"}]),T=n([{key:"생산 중",value:"0"},{key:"생산 완료",value:"1"},{key:"일부 생산 실패",value:"-1"},{key:"생산 실패",value:"-2"}]),J=D(()=>{const s={};for(const{value:t,key:e}of T.value)s[String(t)]={label:e,color:t==="0"?"warning":"success"};return s}),P=D(()=>h.value.map(s=>s.itemId)),O=D(()=>new Set(P.value)),W=async()=>{try{const{data:s}=await F.get("/api/prod/itemlist/notmaterial"),t=O.value;return(s??[]).filter(e=>!t.has(e.itemId))}catch(s){return console.error(s),[]}},X=s=>{h.value.push(s)},Y=s=>{const t=h.value.findIndex(e=>e.itemId===s);t!==-1&&h.value.splice(t,1)},Z=()=>{N.value=!0},B=s=>!!f.value[String(s.instructNo)],ee=s=>{const t=String(s.instructNo),e={...f.value};e[t]?delete e[t]:(e[t]=!0,A(s)),f.value=e},R=s=>{const t=Number(s??0);return Number.isNaN(t)?"0":t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")};return(s,t)=>(u(),p(C,null,[a(j,{elevation:"10"},{default:l(()=>[a(M,{class:"py-6 px-6"},{default:l(()=>[a(U,{fluid:""},{default:l(()=>[a(se,{title:"생산 지시 조회"}),a(E,{"no-gutters":""},{default:l(()=>[a(w,{cols:"6",class:"px-2 d-flex align-center"},{default:l(()=>[a(ae,{label:"생산 지시 번호",modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=e=>y.value=e),variant:"outlined","hide-details":""},{"append-inner":l(()=>[a(Q,{onClick:g},{default:l(()=>t[5]||(t[5]=[m("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a(w,{cols:"6",class:"px-2"},{default:l(()=>[d("div",re,[t[6]||(t[6]=d("label",{class:"font-weight-bold text-body-2"},"품목 유형",-1)),a(K,{modelValue:b.value,"onUpdate:modelValue":t[1]||(t[1]=e=>b.value=e),column:"",multiple:"","selected-class":"active"},{default:l(()=>[(u(!0),p(C,null,S(H.value,e=>(u(),z(v,{key:e.key,value:e.value,variant:"outlined",pill:"",size:"small"},{default:l(()=>[m(c(e.key),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])])]),_:1})]),_:1}),a(E,{"no-gutters":"",class:"mt-4"},{default:l(()=>[a(w,{cols:"6",class:"px-2"},{default:l(()=>[d("div",ne,[t[8]||(t[8]=d("label",{class:"font-weight-bold text-body-2 mb-1"},"품목",-1)),d("div",ue,[(u(!0),p(C,null,S(h.value,e=>(u(),z(v,{key:e.itemId,variant:"outlined",pill:"",color:"primary",size:"small",closable:"","close-icon":"mdi-close","close-icon-size":"14","onClick:close":o=>Y(e.itemId)},{default:l(()=>[d("p",null,[m(c(e.itemId)+" ",1),d("span",ce,c(e.itemName),1)])]),_:2},1032,["onClick:close"]))),128)),a(v,{"append-icon":"mdi-plus-circle",variant:"flat",pill:"",size:"small",onClick:Z},{default:l(()=>t[7]||(t[7]=[d("span",{style:{"font-weight":"bold"}},"품목 추가",-1)])),_:1})])])]),_:1}),a(w,{cols:"6",class:"px-2"},{default:l(()=>[d("div",me,[t[9]||(t[9]=d("label",{class:"font-weight-bold text-body-2"},"상태",-1)),a(K,{modelValue:_.value,"onUpdate:modelValue":t[2]||(t[2]=e=>_.value=e),column:"",multiple:"","selected-class":""},{default:l(()=>[(u(!0),p(C,null,S(T.value,e=>(u(),z(v,{key:e.key,value:e.value,variant:"outlined",color:e.value==1?"success":e.value==0?"primary":e.value==-1?"warning":"error",pill:"",size:"small"},{default:l(()=>[m(c(e.key),1)]),_:2},1032,["value","color"]))),128))]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(j,{elevation:"10",class:"mt-4"},{default:l(()=>[a(M,{class:"py-6 px-6"},{default:l(()=>[a(U,{fluid:""},{default:l(()=>[a(i(G),{value:V.value,paginator:"",rows:10,dataKey:"instructNo",expandedRows:f.value,"onUpdate:expandedRows":t[3]||(t[3]=e=>f.value=e),tableStyle:{"table-layout":"fixed",width:"100%"},size:"small"},{expansion:l(({data:e})=>[d("div",he,[I.value.has(e.instructNo)?(u(),p("div",ve,"세부 지시 불러오는 중…")):(u(),p("div",fe,[a(i(G),{value:x.value[e.instructNo]||[],size:"small",responsiveLayout:"scroll",tableStyle:{"table-layout":"fixed",width:"100%"}},{default:l(()=>[a(i(r),{field:"detaInstructNo",header:"세부 지시 번호",headerClass:"th th-left",bodyClass:"td ellipsis",style:{width:"14rem"}}),a(i(r),{field:"itemId",header:"품목번호",headerClass:"th th-left",bodyClass:"td ellipsis",style:{width:"10rem"}}),a(i(r),{field:"itemName",header:"품목명",headerClass:"th th-left",bodyClass:"td ellipsis",style:{width:"18rem"}}),a(i(r),{header:"지시 수량",headerClass:"th th-right",bodyClass:"td td-right",style:{width:"8rem"}},{body:l(({data:o})=>[d("span",ye,[m(c(R(o.goalQty)),1),o.unit?(u(),p("span",be,c(o.unit),1)):q("",!0)])]),_:1}),a(i(r),{header:"현재 생산 수량",headerClass:"th th-right",bodyClass:"td td-right",style:{width:"8rem"}},{body:l(({data:o})=>[d("span",_e,[m(c(R(o.currProdQty)),1),o.unit?(u(),p("span",xe,c(o.unit),1)):q("",!0)])]),_:1}),a(i(r),{header:"상태",headerClass:"th th-center",bodyClass:"td td-center",style:{width:"6rem"}},{body:l(({data:o})=>[a(v,{size:"x-small",variant:"outlined",color:o.prcsName==="생산 완료"?"success":o.prcsName==="전량 폐기"?"error":"primary",label:""},{default:l(()=>[m(c(o.prcsName),1)]),_:2},1032,["color"])]),_:1})]),_:2},1032,["value"])]))])]),default:l(()=>[a(i(r),{field:"instructNo",sortable:"",header:"지시 번호",headerClass:"th th-center",bodyClass:"td td-center ellipsis",style:{width:"10rem"}}),a(i(r),{field:"itemType",sortable:"",header:"품목 유형",headerClass:"th th-center",bodyClass:"td td-center ellipsis",style:{width:"8rem"}}),a(i(r),{header:"지시 상태",headerClass:"th th-center",bodyClass:"td td-center",style:{width:"8rem"}},{body:l(({data:e})=>[a(v,{size:"x-small",variant:"outlined",color:e.status==1?"success":e.status==0?"primary":e.status==-1?"warning":"error",label:""},{default:l(()=>{var o;return[m(c((o=J.value[String(e.status)])==null?void 0:o.label),1)]}),_:2},1032,["color"])]),_:1}),a(i(r),{field:"instructionDatetimeFormatted",sortable:"",header:"지시 일자",headerClass:"th th-center",bodyClass:"td td-center ellipsis",style:{width:"10rem"}}),a(i(r),{field:"startDatetimeFormatted",header:"시작 일자",headerClass:"th th-center",bodyClass:"td td-center ellipsis",style:{width:"10rem"}}),a(i(r),{field:"goalDatetimeFormatted",header:"목표 생산 일자",headerClass:"th th-center",bodyClass:"td td-center ellipsis",style:{width:"12rem"}}),a(i(r),{expander:"",header:"",headerClass:"th th-center th-tight",bodyClass:"td td-center",style:{width:"3rem"}},{body:l(({data:e})=>[d("button",{class:"row-toggler",onClick:le(o=>ee(e),["stop"]),"aria-expanded":B(e)},[a(Q,{size:"18"},{default:l(()=>[m(c(B(e)?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:2},1024)],8,pe)]),_:1})]),_:1},8,["value","expandedRows"])]),_:1})]),_:1})]),_:1}),a(oe,{visible:N.value,title:"품목 검색",idField:"itemId",columns:[{key:"itemId",label:"품목 번호"},{key:"itemType",label:"품목 유형"},{key:"itemName",label:"품목명"}],fetchData:W,"exclude-ids":P.value,"page-size":5,onSelect:X,onClose:t[4]||(t[4]=e=>N.value=!1)},null,8,["visible","exclude-ids"])],64))}},ze=de(ge,[["__scopeId","data-v-640b0c8d"]]);export{ze as default};
