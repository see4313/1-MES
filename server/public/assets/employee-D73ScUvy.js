import{r as i,m as ke,M as V,D as ge,c as we,o as Ce,b as t,w as n,N as O,Q as te,U as s,T as Y,ac as d,aj as k,x as R,ap as T,s as J,a as Me,u as v,d as ne,t as Ue,V as je,an as xe,F as Ne,c0 as P}from"./index-BkcQ_3tW.js";import{_ as E}from"./CommonModal-eUFOkW9R.js";import{a as g}from"./index-NIGUFBhG.js";import{_ as Se}from"./card-header-btn3k-B0xKRUFF.js";import{_ as Ye}from"./card-header-btn2k-BsHGyKI1.js";import{s as Pe,a as c}from"./index-C6cMUqqj.js";import{d as I}from"./dayjs.min-CQa8u9th.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-gnU0ypJ3.js";const $e={class:"card"},Be={__name:"employee",setup(Ae){const p=a=>a?a instanceof Date?a:new Date(a):null,q=a=>a?I(a).format("YYYY-MM-DD"):null,H=i([]);ke(()=>{N()});const w=i(!1),C=i(!1),y=i(null),D=i(null),oe=V(()=>y.value?I(y.value).format("YYYY-MM-DD"):""),se=V(()=>D.value?I(D.value).format("YYYY-MM-DD"):""),K=V({get:()=>y.value,set:a=>y.value=p(a)}),Q=V({get:()=>D.value,set:a=>D.value=p(a)}),$=i(!1),B=i(!1),ue=V(()=>o.value.joinDate?I(o.value.joinDate).format("YYYY-MM-DD"):""),ie=V(()=>o.value.leavDate?I(o.value.leavDate).format("YYYY-MM-DD"):""),G=V({get:()=>o.value.joinDate,set:a=>o.value.joinDate=p(a)}),W=V({get:()=>o.value.leavDate,set:a=>o.value.leavDate=p(a)}),u=i({name:"",dept:"",phone:"",joinDate:null,leavDate:null,status:"",permName:""}),o=i({id:null,name:"",dept:"",phone:"",joinDate:null,leavDate:null,status:"",permName:"",remark:""}),M=i(!1),U=i(!1),j=i(!1),b=i("search"),x=async()=>{var a,e;w.value=!1,C.value=!1,$.value=!1,B.value=!1,M.value=!1,U.value=!1,j.value=!1,await P(),(e=(a=document.activeElement)==null?void 0:a.blur)==null||e.call(a)},X=async a=>{await x(),b.value=a,await P(),j.value=!0},Z=async a=>{await x(),b.value=a,await P(),U.value=!0},_=async a=>{await x(),b.value=a,await P(),M.value=!0},de=a=>{const e=(a==null?void 0:a.status)||"";b.value==="create"?o.value.status=e:u.value.status=e,M.value=!1},re=a=>{const e=(a==null?void 0:a.perm_name)||"";b.value==="create"?o.value.permName=e:u.value.permName=e,U.value=!1},me=a=>{const e=(a==null?void 0:a.dept_name)||"";b.value==="create"?o.value.dept=e:u.value.dept=e,j.value=!1},ve=async()=>{try{const a=await g.get("/api/status");return Array.isArray(a.data)?a.data:a.data.items??[]}catch(a){return console.error("상태 조회 실패",a),[]}},pe=async()=>{try{const a=await g.get("/api/perm");return Array.isArray(a.data)?a.data:a.data.items??[]}catch(a){return console.error("권한 조회 실패",a),[]}},fe=async()=>{try{const a=await g.get("/api/dept");return Array.isArray(a.data)?a.data:a.data.items??[]}catch(a){return console.error("부서 조회 실패",a),[]}},N=async()=>{const a={...u.value},{data:e}=await g.post("/api/emp/search",a);H.value=Array.isArray(e)?e:e.items??[]},A=i(null);function ce(){o.value={id:null,name:"",dept:"",phone:"",joinDate:null,leavDate:null,status:"",permName:"",remark:""}}ge(A,a=>{if(!a)return ce();o.value={id:a.empId??null,name:a.empName??"",dept:a.deptName??"",phone:a.phone??"",joinDate:p(a.join)??null,leavDate:p(a.leav)??null,status:a.status??"",permName:a.perm??"",remark:a.remk??""}});const h=a=>!!(a.name&&a.dept&&a.phone&&a.joinDate&&a.status&&a.permName),F=i(!1),ee=i(""),ae=i("success"),m=(a,e="success")=>{ee.value=a,ae.value=e,F.value=!0},Ve=async()=>{var e,l,S;const a=(e=A.value)==null?void 0:e.empId;if(!a)return m("삭제할 사원을 선택해주세요.","warning");if(confirm("삭제하시겠습니까?"))try{const{data:r}=await g.delete("/api/empDelete",{data:{emp_id:a}});if(!(r!=null&&r.result))return m((r==null?void 0:r.message)||"삭제에 실패했습니다.","warning");m("삭제되었습니다.","success"),await N(),le()}catch(r){m(((S=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:S.message)||"삭제 중 오류가 발생했습니다.","error")}};async function ye(){var l,S,r;const a=!!o.value.id;if(!a&&!h(o.value)){m("필수 항목을 확인하세요.","warning");return}if(a&&!h(o.value)){m("필수 항목을 확인하세요.","warning");return}const e={...o.value,joinDate:q(o.value.joinDate),leavDate:q(o.value.leavDate)};if(!(!a&&!window.confirm("등록하시겠습니까?")))try{const f=a?`/api/emp/${o.value.id}`:"/api/emp";await g[a?"put":"post"](f,e),m(a?"수정이 완료되었습니다.":"등록이 완료되었습니다.","success"),await N()}catch(f){const z=(l=f==null?void 0:f.response)==null?void 0:l.status,L=(r=(S=f==null?void 0:f.response)==null?void 0:S.data)==null?void 0:r.message;a?m(L||"수정 중 오류가 발생했습니다.","error"):z===409?m(L||"이미 등록된 사원입니다!","warning"):z===400?m(L||"입력값을 확인하세요.","warning"):m(L||"등록 중 오류가 발생했습니다.","error")}finally{await x()}}const De=ye,le=async()=>{o.value={id:null,name:"",dept:"",phone:"",joinDate:null,leavDate:null,status:"",permName:"",remark:""},await x()},be=async()=>{u.value={name:"",dept:"",phone:"",joinDate:null,leavDate:null,status:"",permName:""},y.value=null,D.value=null,w.value=!1,C.value=!1,await P(),await N()};return(a,e)=>(Ce(),we(Ne,null,[t(Y,null,{default:n(()=>[t(O,{elevation:"10",class:"pa-6"},{default:n(()=>[t(te,{class:"py-6 px-6"},{default:n(()=>[t(Ye,{title:"사원 관리","btn-text2":"조회","btn-color2":"primary","btn-variant2":"flat",onBtnClick2:N,"btn-text1":"초기화","btn-color1":"secondary","btn-variant1":"flat",onBtnClick1:be})]),_:1}),t(s,{cols:"12",md:"12"},{default:n(()=>[t(Y,{dense:""},{default:n(()=>[t(s,{cols:"12",sm:"4"},{default:n(()=>[t(d,{variant:"outlined",label:"사원명",modelValue:u.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>u.value.name=l)},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:n(()=>[t(d,{variant:"outlined",label:"부서명",modelValue:u.value.dept,"onUpdate:modelValue":e[1]||(e[1]=l=>u.value.dept=l),"append-inner-icon":"mdi-magnify","onClick:appendInner":e[2]||(e[2]=k(l=>X("search"),["stop"]))},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:n(()=>[t(d,{variant:"outlined",label:"연락처",modelValue:u.value.phone,"onUpdate:modelValue":e[3]||(e[3]=l=>u.value.phone=l)},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:n(()=>[t(R,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=l=>w.value=l),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:n(({props:l})=>[t(d,J(l,{label:"입사일","append-inner-icon":"mdi-calendar",variant:"outlined","model-value":oe.value}),null,16,["model-value"])]),default:n(()=>[t(T,{modelValue:K.value,"onUpdate:modelValue":[e[4]||(e[4]=l=>K.value=l),e[5]||(e[5]=l=>{y.value=p(l),u.value.joinDate=y.value,w.value=!1})]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:n(()=>[t(R,{modelValue:C.value,"onUpdate:modelValue":e[9]||(e[9]=l=>C.value=l),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:n(({props:l})=>[t(d,J(l,{label:"퇴사일","append-inner-icon":"mdi-calendar",variant:"outlined","model-value":se.value}),null,16,["model-value"])]),default:n(()=>[t(T,{modelValue:Q.value,"onUpdate:modelValue":[e[7]||(e[7]=l=>Q.value=l),e[8]||(e[8]=l=>{D.value=p(l),u.value.leavDate=D.value,C.value=!1})]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:n(()=>[t(d,{variant:"outlined",label:"사원상태",modelValue:u.value.status,"onUpdate:modelValue":e[10]||(e[10]=l=>u.value.status=l),"append-inner-icon":"mdi-magnify","onClick:appendInner":e[11]||(e[11]=k(l=>_("search"),["stop"]))},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:n(()=>[t(d,{variant:"outlined",label:"권한",modelValue:u.value.permName,"onUpdate:modelValue":e[12]||(e[12]=l=>u.value.permName=l),"append-inner-icon":"mdi-magnify","onClick:appendInner":e[13]||(e[13]=k(l=>Z("search"),["stop"]))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(Y,null,{default:n(()=>[t(O,{elevation:"10",class:"pa-6 mt-2"},{default:n(()=>[t(s,{cols:"12"},{default:n(()=>[Me("div",$e,[t(v(Pe),{value:H.value,selection:A.value,"onUpdate:selection":e[14]||(e[14]=l=>A.value=l),selectionMode:"single",dataKey:"empId",tableStyle:"min-width: 50rem",rowHover:"",paginator:!0,rows:5,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"RowsPerPageDropdown PrevPageLink PageLinks NextPageLink"},{default:n(()=>[t(v(c),{field:"empId",sortable:"",header:"사원번호"}),t(v(c),{field:"empName",header:"사원명"}),t(v(c),{field:"deptName",header:"소속부서"}),t(v(c),{field:"phone",header:"연락처"}),t(v(c),{field:"join",header:"입사일"}),t(v(c),{field:"leav",header:"퇴사일"}),t(v(c),{field:"status",header:"사원상태"}),t(v(c),{field:"perm",header:"사원권한"}),t(v(c),{field:"remk",header:"비고"})]),_:1},8,["value","selection"])])]),_:1})]),_:1})]),_:1}),t(Y,null,{default:n(()=>[t(O,{elevation:"10",class:"pa-6 mt-2"},{default:n(()=>[t(te,{class:"py-6 px-6"},{default:n(()=>[t(Se,{title:"사원 등록","btn-text3":"저장","btn-color3":"warning","btn-variant3":"flat",onBtnClick3:v(De),"btn-text2":"삭제","btn-variant2":"flat","btn-color2":"error","btn-disabled2":!o.value.id,onBtnClick2:Ve,"btn-text1":"초기화","btn-color1":"secondary","btn-variant1":"flat",onBtnClick1:le},null,8,["onBtnClick3","btn-disabled2"])]),_:1}),t(s,{cols:"12",md:"12"},{default:n(()=>[t(Y,{dense:""},{default:n(()=>[t(s,{cols:"12",sm:"4"},{default:n(()=>[t(d,{variant:"outlined",label:"사원명",modelValue:o.value.name,"onUpdate:modelValue":e[15]||(e[15]=l=>o.value.name=l)},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:n(()=>[t(d,{variant:"outlined",label:"부서명",modelValue:o.value.dept,"onUpdate:modelValue":e[16]||(e[16]=l=>o.value.dept=l),"append-inner-icon":"mdi-magnify","onClick:appendInner":e[17]||(e[17]=k(l=>X("create"),["stop"])),readonly:""},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:n(()=>[t(d,{variant:"outlined",label:"연락처",modelValue:o.value.phone,"onUpdate:modelValue":e[18]||(e[18]=l=>o.value.phone=l)},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:n(()=>[t(R,{modelValue:$.value,"onUpdate:modelValue":e[21]||(e[21]=l=>$.value=l),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:n(({props:l})=>[t(d,J(l,{label:"입사일","append-inner-icon":"mdi-calendar",variant:"outlined","model-value":ue.value}),null,16,["model-value"])]),default:n(()=>[t(T,{modelValue:G.value,"onUpdate:modelValue":[e[19]||(e[19]=l=>G.value=l),e[20]||(e[20]=l=>{o.value.joinDate=p(l),$.value=!1})]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:n(()=>[t(R,{modelValue:B.value,"onUpdate:modelValue":e[24]||(e[24]=l=>B.value=l),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:n(({props:l})=>[t(d,J(l,{label:"퇴사일","append-inner-icon":"mdi-calendar",variant:"outlined","model-value":ie.value}),null,16,["model-value"])]),default:n(()=>[t(T,{modelValue:W.value,"onUpdate:modelValue":[e[22]||(e[22]=l=>W.value=l),e[23]||(e[23]=l=>{o.value.leavDate=p(l),B.value=!1})]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:n(()=>[t(d,{variant:"outlined",label:"사원상태",modelValue:o.value.status,"onUpdate:modelValue":e[25]||(e[25]=l=>o.value.status=l),"append-inner-icon":"mdi-magnify","onClick:appendInner":e[26]||(e[26]=k(l=>_("create"),["stop"])),readonly:""},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:n(()=>[t(d,{variant:"outlined",label:"권한",modelValue:o.value.permName,"onUpdate:modelValue":e[27]||(e[27]=l=>o.value.permName=l),"append-inner-icon":"mdi-magnify","onClick:appendInner":e[28]||(e[28]=k(l=>Z("create"),["stop"])),readonly:""},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:n(()=>[t(d,{variant:"outlined",label:"비고",modelValue:o.value.remark,"onUpdate:modelValue":e[29]||(e[29]=l=>o.value.remark=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(xe,{modelValue:F.value,"onUpdate:modelValue":e[31]||(e[31]=l=>F.value=l),timeout:2e3,color:ae.value,location:"top right",rounded:"pill"},{actions:n(()=>[t(je,{variant:"text",onClick:e[30]||(e[30]=l=>F.value=!1)},{default:n(()=>e[35]||(e[35]=[ne("닫기")])),_:1})]),default:n(()=>[ne(Ue(ee.value)+" ",1)]),_:1},8,["modelValue","color"]),t(E,{visible:M.value,title:"상태검색",idField:"emp_status",columns:[{key:"status_id",label:"상태코드"},{key:"status",label:"상태명"}],fetchData:ve,pageSize:5,onSelect:de,onClose:e[32]||(e[32]=l=>M.value=!1)},null,8,["visible"]),t(E,{visible:U.value,title:"권한검색",idField:"emp_perm",columns:[{key:"perm_id",label:"권한코드"},{key:"perm_name",label:"권한명"}],fetchData:pe,pageSize:5,onSelect:re,onClose:e[33]||(e[33]=l=>U.value=!1)},null,8,["visible"]),t(E,{visible:j.value,title:"부서검색",idField:"dept",columns:[{key:"dept_id",label:"부서코드"},{key:"dept_name",label:"부서명"}],fetchData:fe,pageSize:10,onSelect:me,onClose:e[34]||(e[34]=l=>j.value=!1)},null,8,["visible"])],64))}},He=Ie(Be,[["__scopeId","data-v-2c1b4759"]]);export{He as default};
