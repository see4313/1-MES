import{_ as ee}from"./card-header-btn2-3eeFV3jL.js";import{_ as le}from"./card-header-btn-CibSipEU.js";import{_ as $}from"./CommonModal-DAUXa4tk.js";import{s as ae,a as V}from"./index-DzeG4XAE.js";import{P as te}from"./ProductService-BtITuo-x.js";import{d as R}from"./dayjs.min-CQa8u9th.js";import{a as I}from"./index-NIGUFBhG.js";import{_ as ne}from"./SnackBar-HH3n22ps.js";import{u as oe}from"./useSnackBar-IN_qynCK.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{m as ue,r as u,M as q,c as de,o as se,b as a,w as n,N as P,U as v,Q as z,T as S,ac as p,u as m,x as j,ap as K,s as T,a as ie,d as g,a0 as me,t as F,F as ve}from"./index-vUQOwfGq.js";import"./_commonjsHelpers-gnU0ypJ3.js";const pe={class:"order"},fe={__name:"orderInsert",setup(ce){ue(()=>{te.getProductsMini().then(t=>E.value=t)});const{snackBar:r}=oe(),E=u(),f=u([]),x=u(!1),d=u(null),C=u(!1),s=u(null),M=u(null),J=t=>{M.value=t,y.value=!0},B=q(()=>d.value?R(d.value).format("YYYY-MM-DD"):""),N=q(()=>s.value?R(s.value).format("YYYY-MM-DD"):""),D=u(!1),U=u(!1),y=u(!1),_=u(null),b=u(null);u(null);const k=u(null),w=u(null),L=(t,l,e)=>{let o=t.target.value.replace(/[^0-9]/g,"");if(o===""){l[e]=0,t.target.value="";return}l[e]=Number(o),t.target.value=new Intl.NumberFormat("ko-KR").format(o)+"원"},Q=async()=>{try{return(await I.get("/api/empModal")).data}catch{return r("조회 실패.","error"),[]}},A=async()=>{try{return(await I.get("/api/vend")).data}catch{return r("조회 실패.","error"),[]}},G=async()=>{try{return(await I.get("/api/itemModal1")).data}catch{return r("조회 실패.","error"),[]}},H=t=>{_.value=t.emp_name,k.value=t.emp_id},O=t=>{b.value=t.vend_name,w.value=t.vend_id},W=t=>{if(M.value!==null){const l=f.value[M.value];l.item_id=t.item_id,l.item_name=t.item_name}y.value=!1};let i=u({order_id:"",ordr:"",emp_id:"",vend_id:"",ordr_date:"",paprd_date:"",remk:""});u(!1);const X=async()=>{if(!i.value.ordr){r("주문명을 입력해주세요.","error");return}if(!k.value){r("담당자를 선택해주세요.","error");return}if(!w.value){r("업체명을 선택해주세요.","error");return}if(!d.value){r("주문일자를 선택해주세요.","error");return}if(!s.value){r("납기일자를 선택해주세요.","error");return}if(d.value&&s.value&&new Date(s.value)<new Date(d.value)){r("납기일자는 주문일자보다 빠를 수 없습니다.","error");return}try{const t={ordr:i.value.ordr,emp_id:k.value,vend_id:w.value,ordr_date:B.value,paprd_date:N.value,remk:i.value.remk,details:f.value.map(e=>({item_id:e.item_id,qty:e.qty,amt:e.amt}))},l=await I.post("/api/orderInsert",t);confirm("등록하시겠습니까?")&&(l.data.result?(r("등록 성공","success"),Y(),f.value=[]):r("등록 실패","warning"))}catch(t){console.error(t),r("에러","error")}},Z=()=>{if(!i.value.ordr){r("주문명을 입력해주세요.","error");return}if(!k.value){r("담당자를 선택해주세요.","error");return}if(!w.value){r("업체명을 선택해주세요.","error");return}if(!d.value){r("주문일자를 선택해주세요.","error");return}if(!s.value){r("납기일자를 선택해주세요.","error");return}f.value.push({item_id:"",item_name:"",qty:0,amt:0,allamt:0})},h=t=>{const{data:l,field:e,newValue:o}=t;l[e]!==o&&(l[e]=o,(e==="qty"||e==="amt")&&(l.allamt=l.qty*l.amt))};function Y(){i.value.ordr=null,_.value=null,b.value=null,d.value=null,s.value=null,i.value.remk=null}return(t,l)=>(se(),de(ve,null,[a(S,null,{default:n(()=>[a(P,{elevation:"10"},{default:n(()=>[a(v,{cols:"12",md:"12"},{default:n(()=>[a(z,{class:"py-6 px-6"},{default:n(()=>[a(ee,{title:"주문 등록","btn-text1":"등록","btn-variant1":"flat","btn-color1":"warning",onBtnClick1:l[0]||(l[0]=e=>X()),"btn-text2":"초기화","btn-variant2":"flat","btn-color2":"secondary",onBtnClick2:l[1]||(l[1]=e=>Y())})]),_:1}),a(S,{dense:""},{default:n(()=>[a(v,{cols:"12",sm:"4"},{default:n(()=>[a(p,{variant:"outlined",label:"주문명",modelValue:m(i).ordr,"onUpdate:modelValue":l[2]||(l[2]=e=>m(i).ordr=e)},null,8,["modelValue"])]),_:1}),a(v,{cols:"12",sm:"4"},{default:n(()=>[a(p,{variant:"outlined",label:"담당자","append-inner-icon":"mdi-magnify","onClick:appendInner":l[3]||(l[3]=e=>D.value=!0),modelValue:_.value,"onUpdate:modelValue":l[4]||(l[4]=e=>_.value=e),readonly:""},null,8,["modelValue"])]),_:1}),a(v,{cols:"12",sm:"4"},{default:n(()=>[a(p,{variant:"outlined",label:"업체명","append-inner-icon":"mdi-magnify","onClick:appendInner":l[5]||(l[5]=e=>U.value=!0),modelValue:b.value,"onUpdate:modelValue":l[6]||(l[6]=e=>b.value=e),readonly:""},null,8,["modelValue"])]),_:1}),a(v,{cols:"12",sm:"4"},{default:n(()=>[a(j,{modelValue:x.value,"onUpdate:modelValue":l[10]||(l[10]=e=>x.value=e),"close-on-content-click":!0,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:n(({props:e})=>[a(p,T(e,{modelValue:d.value,"onUpdate:modelValue":l[7]||(l[7]=o=>d.value=o),label:"주문일자","append-inner-icon":"mdi-calendar",readonly:"",variant:"outlined","model-value":B.value}),null,16,["modelValue","model-value"])]),default:n(()=>[a(K,{modelValue:d.value,"onUpdate:modelValue":l[8]||(l[8]=e=>d.value=e),onChange:l[9]||(l[9]=e=>x.value=!1)},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),a(v,{cols:"12",sm:"4"},{default:n(()=>[a(j,{modelValue:C.value,"onUpdate:modelValue":l[14]||(l[14]=e=>C.value=e),"close-on-content-click":!0,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:n(({props:e})=>[a(p,T(e,{modelValue:s.value,"onUpdate:modelValue":l[11]||(l[11]=o=>s.value=o),label:"납기일자","append-inner-icon":"mdi-calendar",readonly:"",variant:"outlined","model-value":N.value}),null,16,["modelValue","model-value"])]),default:n(()=>[a(K,{modelValue:s.value,"onUpdate:modelValue":l[12]||(l[12]=e=>s.value=e),onChange:l[13]||(l[13]=e=>C.value=!1)},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),a(v,{cols:"12",sm:"4"},{default:n(()=>[a(p,{variant:"outlined",label:"비고",modelValue:m(i).remk,"onUpdate:modelValue":l[15]||(l[15]=e=>m(i).remk=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(S,{class:"mt-10"},{default:n(()=>[a(P,{elevation:"10"},{default:n(()=>[a(v,{cols:"12"},{default:n(()=>[ie("div",pe,[a(z,{class:"py-6 px-6"},{default:n(()=>[a(le,{title:"상세 주문등록","btn-icon":"mdi-plus-circle","btn-text":"행추가","btn-variant":"flat","btn-color":"#424242",onBtnClick:Z})]),_:1}),a(m(ae),{value:f.value,tableStyle:"min-width: 50rem",editMode:"cell",onCellEditComplete:h},{default:n(()=>[a(m(V),{field:"item_id",sortable:"",header:"제품번호"},{body:n(e=>[a(me,{class:"cursor-pointer",onClick:o=>J(e.index),style:{"margin-left":"8px"}},{default:n(()=>l[19]||(l[19]=[g(" mdi-magnify ")])),_:2},1032,["onClick"]),g(" "+F(e.data.item_id),1)]),_:1}),a(m(V),{field:"item_name",header:"제품명"}),a(m(V),{field:"qty",header:"수량",style:{width:"120px"}},{editor:n(({data:e,field:o})=>[a(p,{type:"number",dense:"","hide-details":"",style:{width:"100px"},variant:"outlined",min:"0",modelValue:e[o],"onUpdate:modelValue":c=>e[o]=c,class:"custom-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(m(V),{field:"amt",header:"금액 (원)",style:{width:"120px"}},{editor:n(({data:e,field:o})=>[a(p,{type:"number",dense:"","hide-details":"",style:{width:"100px"},variant:"outlined",min:"0",modelValue:e[o],"onUpdate:modelValue":c=>e[o]=c,class:"custom-input",onInput:c=>L(c,e,o)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),body:n(({data:e})=>[g(F(e.amt?new Intl.NumberFormat("ko-KR").format(e.amt)+"원":""),1)]),_:1}),a(m(V),{field:"allamt",header:"총금액 (원)"},{body:n(({data:e})=>[g(F(e.allamt?new Intl.NumberFormat("ko-KR").format(e.allamt)+"원":""),1)]),_:1})]),_:1},8,["value"])])]),_:1})]),_:1})]),_:1}),a($,{visible:D.value,title:"사원 검색",idField:"emp_id",columns:[{key:"emp_id",label:"사원번호"},{key:"dept_id",label:"부서"},{key:"emp_name",label:"사원명"}],fetchData:Q,pageSize:5,onSelect:H,onClose:l[16]||(l[16]=e=>D.value=!1)},null,8,["visible"]),a($,{visible:U.value,title:"업체명",idField:"vend_id",columns:[{key:"vend_id",label:"업체번호"},{key:"biz_number",label:"사업자번호"},{key:"vend_name",label:"거래처명"}],fetchData:A,pageSize:5,onSelect:O,onClose:l[17]||(l[17]=e=>U.value=!1)},null,8,["visible"]),a($,{visible:y.value,title:"제품코드",idField:"item_id",columns:[{key:"item_id",label:"제품코드"},{key:"item_name",label:"제품명"}],fetchData:G,pageSize:5,onSelect:W,onClose:l[18]||(l[18]=e=>y.value=!1)},null,8,["visible"]),a(ne)],64))}},Ue=re(fe,[["__scopeId","data-v-5d9f18aa"]]);export{Ue as default};
