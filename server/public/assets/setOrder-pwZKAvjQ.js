import{_ as ee}from"./card-header-btn2-3eeFV3jL.js";import{s as le,a as y}from"./index-DzeG4XAE.js";import{P as ae}from"./ProductService-BtITuo-x.js";import{d as V}from"./dayjs.min-CQa8u9th.js";import{_ as U}from"./CommonModal-DAUXa4tk.js";import{a as c}from"./index-NIGUFBhG.js";import{_ as te}from"./SnackBar-HH3n22ps.js";import{u as ne}from"./useSnackBar-IN_qynCK.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{m as de,r as o,M as B,D as re,c as ue,o as se,b as t,w as n,U as i,Q as ie,T as $,ac as m,x as O,ap as F,s as N,N as R,a as q,u as p,d as z,t as me,V as ve,a0 as pe,F as fe}from"./index-vUQOwfGq.js";import"./_commonjsHelpers-gnU0ypJ3.js";const ce={class:"card"},ye={__name:"setOrder",setup(Ve){de(()=>{ae.getProductsMini().then(a=>E.value=a)});const{snackBar:v}=ne(),E=o([]),d=o([]),M=o(!1),r=o(null),C=o(!1),u=o(null),b=o(null),_=o(null),Y=o(!1),f=o(null),x=o(!1),w=o(null),I=o(!1),k=o(null),S=o([]),D=o(null),g=o(null);o(null);const j=B(()=>r.value?V(r.value).format("YYYY-MM-DD"):""),T=B(()=>u.value?V(u.value).format("YYYY-MM-DD"):""),K=a=>a?new Intl.NumberFormat("ko-KR").format(a)+"원":"",J=(a,e)=>{const l=d.value[a][e];if(!l){d.value[a][e]="";return}d.value[a][e]=Number(l)};re(f,async a=>{if(a)try{const e={order_id:a},l=await c.get("/api/detailOrder",{params:e});d.value=l.data,console.log(d.value)}catch(e){console.error("주문상세 불러오기 실패",e),d.value=[]}else d.value=[]});const L=async()=>{try{return(await c.get("/api/orderModal")).data.map(l=>({...l,ordr_date:V(l.ordr_date).format("YYYY-MM-DD")}))}catch(a){return console.error("조회 실패",a),[]}},P=async()=>{try{return(await c.get("/api/empModal")).data}catch(a){return console.error("조회 실패",a),[]}},Q=async()=>{try{return(await c.get("/api/vend")).data}catch(a){return console.error("조회 실패",a),[]}},A=a=>{console.log(a),f.value=a.order_id,b.value=a.ordr,w.value=a.emp_name,g.value=a.emp_id,k.value=a.vend_name,D.value=a.vend_id,r.value=new Date(a.ordr_date),u.value=new Date(a.paprd_date),_.value=a.remk},G=a=>{w.value=a.emp_name,g.value=a.emp_id},H=a=>{k.value=a.vend_name,D.value=a.vend_id},W=async()=>{if(confirm("삭제하시겠습니까?"))try{v("삭제성공","success"),await c.delete("/api/deleteOrderId",{data:{order_id:f.value}})}catch{v("삭제실패","error")}},X=async a=>{if(confirm("삭제하시겠습니까?"))try{v("삭제성공","success"),await c.delete("/api/deleteOrder",{data:{detail_id:a}}),d.value=d.value.filter(e=>e.detail_id!==a)}catch{v("삭제실패","error")}},Z=async()=>{if(r.value&&u.value&&new Date(u.value)<new Date(r.value)){v("납기일자는 주문일자보다 빠를 수 없습니다.","error");return}try{let a={order_id:f.value,ordr:b.value,vend_id:D.value,emp_id:g.value,ordr_date:r.value?V(r.value).format("YYYY-MM-DD"):null,paprd_date:u.value?V(u.value).format("YYYY-MM-DD"):null,remk:_.value,details:d.value.map(l=>({detail_id:l.detail_id,item_id:l.item_id,qty:l.qty,amt:l.amt}))};if((await c.put("/api/setOrder",a)).data.result){if(!confirm("수정하시겠습니까?"))return;v("수정성공","success"),h()}else v("수정실패","error")}catch{v("에러","error")}};function h(){f.value=null,b.value=null,D.value=null,g.value=null,r.value=null,u.value=null,_.value=null,d.value=null}return(a,e)=>(se(),ue(fe,null,[t(R,{elevation:"10"},{default:n(()=>[t(i,{cols:"12",md:"12"},{default:n(()=>[t(ie,{class:"py-6 px-6"},{default:n(()=>[t(ee,{title:"주문 관리","btn-text1":"수정","btn-variant1":"flat","btn-color1":"warning",onBtnClick1:e[0]||(e[0]=l=>Z()),"btn-text2":"삭제","btn-variant2":"flat","btn-color2":"error",onBtnClick2:e[1]||(e[1]=l=>W())})]),_:1})]),_:1}),t($,{dense:""},{default:n(()=>[t(i,{cols:"12",sm:"3"},{default:n(()=>[t(m,{variant:"outlined",label:"주문코드","append-inner-icon":"mdi-magnify","onClick:appendInner":e[2]||(e[2]=l=>Y.value=!0),modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=l=>f.value=l),readonly:""},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",sm:"3"},{default:n(()=>[t(m,{variant:"outlined",label:"주문명",modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=l=>b.value=l)},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",sm:"3"},{default:n(()=>[t(m,{variant:"outlined",label:"담당자","append-inner-icon":"mdi-magnify","onClick:appendInner":e[5]||(e[5]=l=>x.value=!0),modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=l=>w.value=l),readonly:""},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",sm:"3",rowspan:2,class:"merged-cell"},{default:n(()=>[t(m,{variant:"outlined",label:"비고",modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=l=>_.value=l)},null,8,["modelValue"])]),_:1})]),_:1}),t($,{dense:""},{default:n(()=>[t(i,{cols:"12",sm:"3"},{default:n(()=>[t(m,{variant:"outlined",label:"업체명","append-inner-icon":"mdi-magnify","onClick:appendInner":e[8]||(e[8]=l=>I.value=!0),modelValue:k.value,"onUpdate:modelValue":e[9]||(e[9]=l=>k.value=l),readonly:""},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",sm:"3"},{default:n(()=>[t(O,{modelValue:M.value,"onUpdate:modelValue":e[13]||(e[13]=l=>M.value=l),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:n(({props:l})=>[t(m,N(l,{modelValue:r.value,"onUpdate:modelValue":e[10]||(e[10]=s=>r.value=s),label:"주문일자","append-inner-icon":"mdi-calendar",variant:"outlined","model-value":j.value,readonly:""}),null,16,["modelValue","model-value"])]),default:n(()=>[t(F,{modelValue:r.value,"onUpdate:modelValue":e[11]||(e[11]=l=>r.value=l),onChange:e[12]||(e[12]=l=>M.value=!1)},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),t(i,{cols:"12",sm:"3"},{default:n(()=>[t(O,{modelValue:C.value,"onUpdate:modelValue":e[17]||(e[17]=l=>C.value=l),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:n(({props:l})=>[t(m,N(l,{modelValue:u.value,"onUpdate:modelValue":e[14]||(e[14]=s=>u.value=s),label:"납기일자","append-inner-icon":"mdi-calendar",variant:"outlined","model-value":T.value,readonly:""}),null,16,["modelValue","model-value"])]),default:n(()=>[t(F,{modelValue:u.value,"onUpdate:modelValue":e[15]||(e[15]=l=>u.value=l),onChange:e[16]||(e[16]=l=>C.value=!1)},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t($,{class:"mt-10"},{default:n(()=>[t(R,{elevation:"10"},{default:n(()=>[t(i,{cols:"12"},{default:n(()=>[q("div",ce,[e[23]||(e[23]=q("h3",null,"상세주문관리",-1)),t(p(le),{editingRows:S.value,"onUpdate:editingRows":e[18]||(e[18]=l=>S.value=l),value:d.value,editMode:"cell",dataKey:"item_id",onCellEditComplete:a.onCellEditComplete,tableStyle:"min-width: 50rem",paginator:"",rows:5},{default:n(()=>[t(p(y),{field:"item_id",header:"제품코드",style:{width:"600px"}}),t(p(y),{field:"qty",header:"수량",style:{width:"500px"}},{body:n(l=>[t(m,{modelValue:d.value[l.index].qty,"onUpdate:modelValue":s=>d.value[l.index].qty=s,modelModifiers:{number:!0},type:"number",dense:"","hide-details":"",style:{width:"100px"},variant:"outlined",min:"0"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(p(y),{field:"amt",header:"금액 (원)",style:{width:"500px"}},{body:n(l=>[t(m,{modelValue:d.value[l.index].amt,"onUpdate:modelValue":s=>d.value[l.index].amt=s,modelModifiers:{number:!0},type:"number",dense:"","hide-details":"",style:{width:"100px"},variant:"outlined",min:"0",onBlur:s=>J(l.index,"amt")},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:1}),t(p(y),{field:"tamt",header:"총 금액 (원)",style:{width:"500px"}},{body:n(l=>[z(me(K(l.data.qty*l.data.amt)),1)]),_:1}),t(p(y),{rowEditor:!0,style:{width:"400px"}}),t(p(y),{header:"삭제",style:{width:"80px","text-align":"center"}},{body:n(({data:l})=>[t(ve,{icon:"",color:"error",onClick:s=>X(l.detail_id)},{default:n(()=>[t(pe,{size:"20"},{default:n(()=>e[22]||(e[22]=[z("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["editingRows","value","onCellEditComplete"])])]),_:1})]),_:1})]),_:1}),t(U,{visible:Y.value,title:"주문 검색",idField:"order_id",columns:[{key:"order_id",label:"주문번호"},{key:"vend_name",label:"업체명"},{key:"emp_name",label:"담당자"},{key:"ordr_date",label:"주문일자",format:l=>p(V)(l).format("YYYY-MM-DD")}],fetchData:L,pageSize:5,onSelect:A,onClose:e[19]||(e[19]=l=>Y.value=!1)},null,8,["visible","columns"]),t(U,{visible:x.value,title:"사원 검색",idField:"emp_id",columns:[{key:"emp_id",label:"사원번호"},{key:"dept_id",label:"부서"},{key:"emp_name",label:"사원명"}],fetchData:P,pageSize:5,onSelect:G,onClose:e[20]||(e[20]=l=>x.value=!1)},null,8,["visible"]),t(U,{visible:I.value,title:"업체명",idField:"vend_id",columns:[{key:"vend_id",label:"업체번호"},{key:"biz_number",label:"사업자번호"},{key:"vend_name",label:"거래처명"}],fetchData:Q,pageSize:5,onSelect:H,onClose:e[21]||(e[21]=l=>I.value=!1)},null,8,["visible"]),t(te)],64))}},Ue=oe(ye,[["__scopeId","data-v-1c06c473"]]);export{Ue as default};
