import{_ as N}from"./card-header-BG8Zbe1P.js";import{_ as j}from"./card-header-btn2-3eeFV3jL.js";import{s as M,a as d}from"./index-DzeG4XAE.js";import{_ as S}from"./CommonModal-DAUXa4tk.js";import{a as m}from"./index-NIGUFBhG.js";import{d as f}from"./dayjs.min-CQa8u9th.js";import{_ as E}from"./SnackBar-HH3n22ps.js";import{u as O}from"./useSnackBar-IN_qynCK.js";import{r as s,m as Q,D as R,c as A,o as G,b as e,w as o,N as x,Q as h,T as $,U as q,p as C,ac as w,a0 as U,d as p,u as l,t as B,F as H}from"./index-vUQOwfGq.js";import"./_commonjsHelpers-gnU0ypJ3.js";const de={__name:"setDelivery",setup(J){const{snackBar:i}=O(),c=s(!1),_=s(!1),y=s(null),b=s(null),V=s(null),Y=s(null),k=s(null),D=s(null),g=s(null),v=s(null),u=s(null);Q(()=>{});const F=async()=>{if(!u.value||u.value.length===0){i("출고할 제품을 선택해주세요.","warning");return}try{for(let n of u.value){if(n.qty>n.bnt){i("출고수량이 출고가능수량보다 많습니다.","error");return}if(n.qty<=0){i("출고수량은 0 이상이어야 합니다.","error");return}}if(!confirm("출고하시겠습니까?"))return;console.log(u.value);const r=sessionStorage.getItem("userId");let t=u.value.map(n=>({lot_id:n.lot_id,dlivy_qty:n.qty,detail_id:n.detail_id,emp_id:r}));(await m.post("/api/productUpdate",t)).data.result?(i("출고완료","success"),I()):i("항목을 선택해주세요.","error")}catch{i("에러","error")}};R(v,async r=>{if(!r)g.value=null;else{g.value=r.item_id;try{const t={item_id:g.value},a=await m.get("/api/deliveryList",{params:t});D.value=a.data.map(n=>({...n,detail_id:v.value.detail_id}))}catch{i("조회실패","error")}}});const I=async()=>{try{const r={order_id:V.value,vend_id:Y.value},t=await m.get("/api/setDelivery",{params:r});k.value=t.data}catch{i("조회실패","error")}},L=async()=>{try{return(await m.get("/api/orderModal")).data.map(a=>({...a,ordr_date:f(a.ordr_date).format("YYYY-MM-DD")}))}catch{return i("조회실패","error"),[]}},T=async()=>{try{return(await m.get("/api/vend")).data}catch{return i("조회실패","error"),[]}},z=r=>{y.value=r.order_id,V.value=r.order_id},K=r=>{b.value=r.vend_name,Y.value=r.vend_id};return(r,t)=>(G(),A(H,null,[e($,null,{default:o(()=>[e(x,{elevation:"10"},{default:o(()=>[e(h,{class:"py-6 px-6"},{default:o(()=>[e(j,{title:"출고관리 목록","btn-text1":"조회","btn-variant1":"flat","btn-color1":"primary",onBtnClick1:t[0]||(t[0]=a=>I()),"btn-text2":"출고","btn-variant2":"flat","btn-color2":"warning",onBtnClick2:t[1]||(t[1]=a=>F())})]),_:1}),e($,{"no-gutters":""},{default:o(()=>[e(q,{cols:"12",sm:"4"},{default:o(()=>[e(C,{class:"pa-2 ma-2"},{default:o(()=>[e(w,{variant:"outlined",label:"주문코드",modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=a=>y.value=a),readonly:""},{"append-inner":o(()=>[e(U,{onClick:t[2]||(t[2]=a=>c.value=!0),class:"cursor-pointer"},{default:o(()=>t[10]||(t[10]=[p("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(q,{cols:"12",sm:"4"},{default:o(()=>[e(C,{class:"pa-2 ma-2"},{default:o(()=>[e(w,{variant:"outlined",label:"업체명",modelValue:b.value,"onUpdate:modelValue":t[5]||(t[5]=a=>b.value=a),readonly:""},{"append-inner":o(()=>[e(U,{onClick:t[4]||(t[4]=a=>_.value=!0),class:"cursor-pointer"},{default:o(()=>t[11]||(t[11]=[p("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(l(M),{value:k.value,tableStyle:"min-width: 50rem",class:"cursor-pointer",selection:v.value,"onUpdate:selection":t[6]||(t[6]=a=>v.value=a),selectionMode:"single",metaKeySelection:!1,dataKey:"detail_id",paginator:"",rows:5},{default:o(()=>[e(l(d),{field:"detail_id",header:"주문상세코드"}),e(l(d),{field:"item_id",header:"제품 코드"}),e(l(d),{field:"item_name",header:"제품명"}),e(l(d),{field:"oust_date",header:"출고일자"},{body:o(({data:a})=>[p(B(l(f)(a.ordr_date).format("YYYY-MM-DD")),1)]),_:1}),e(l(d),{field:"vend_name",header:"업체명"}),e(l(d),{field:"order_qty",header:"주문수량"}),e(l(d),{field:"delivered_qty",header:"기납기량"}),e(l(d),{field:"overdue_qty",header:"미납기량"})]),_:1},8,["value","selection"])]),_:1}),e(x,{elevation:"10",class:"mt-4"},{default:o(()=>[e(h,{class:"py-6 px-6"},{default:o(()=>[e(N,{title:"출고 관리"})]),_:1}),e(l(M),{value:D.value,tableStyle:"min-width: 50rem",selection:u.value,"onUpdate:selection":t[7]||(t[7]=a=>u.value=a),selectionMode:"multiple",dataKey:"lot_id",paginator:"",rows:5},{default:o(()=>[e(l(d),{selectionMode:"multiple",headerStyle:"width: 3em"}),e(l(d),{field:"lot_id",header:"LOT번호"}),e(l(d),{field:"item_id",header:"제품코드"}),e(l(d),{field:"item_name",header:"제품명"}),e(l(d),{field:"vald_date",header:"유통기한"},{body:o(({data:a})=>[p(B(l(f)(a.ordr_date).format("YYYY-MM-DD")),1)]),_:1}),e(l(d),{field:"bnt",header:"출고가능수량"}),e(l(d),{field:"dlivy_qty",header:"출고수량"},{body:o(({data:a})=>[e(w,{type:"number",dense:"","hide-details":"",style:{width:"100px"},variant:"outlined",min:"0",max:a.bnt,modelValue:a.qty,"onUpdate:modelValue":n=>a.qty=n},null,8,["max","modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["value","selection"])]),_:1})]),_:1}),e(S,{visible:c.value,title:"주문 검색",idField:"order_id",columns:[{key:"order_id",label:"주문번호"},{key:"vend_name",label:"업체명"},{key:"emp_name",label:"담당자"},{key:"ordr_date",label:"주문일자",format:a=>l(f)(a).format("YYYY-MM-DD")}],fetchData:L,pageSize:5,onSelect:z,onClose:t[8]||(t[8]=a=>c.value=!1)},null,8,["visible","columns"]),e(S,{visible:_.value,title:"업체명",idField:"vend_id",columns:[{key:"vend_id",label:"업체번호"},{key:"biz_number",label:"사업자번호"},{key:"vend_name",label:"거래처명"}],fetchData:T,pageSize:5,onSelect:K,onClose:t[9]||(t[9]=a=>_.value=!1)},null,8,["visible"]),e(E)],64))}};export{de as default};
