import{a as _}from"./index-NIGUFBhG.js";import{_ as ue}from"./card-header-btn2-3eeFV3jL.js";import{_ as se}from"./card-header-btn3k-6zMLpEnU.js";import{s as ie,a as v}from"./index-DzeG4XAE.js";import{_ as P}from"./CommonModal-DAUXa4tk.js";import{u as re}from"./useSnackBar-IN_qynCK.js";import{u as de}from"./useFormatDate-DuO0KNBS.js";import{M as me,r as u,D as ve,c as W,o as X,b as l,w as n,Q as K,T as S,U as r,ac as m,a0 as N,d as U,u as i,N as O,i as ce,y as fe,al as pe,t as _e,am as ye,an as Ve,F as be}from"./index-vUQOwfGq.js";const ge={key:0,class:"text-grey mt-3"},Fe={__name:"CleaningHistMange",setup(ke){const{formatDate:Y}=de(),{snackOpen:I,snackMessage:j,snackColor:Q}=re(),d=(a,e="success")=>{j.value=a,Q.value=e,I.value=!0},q=new Date().toISOString().split("T")[0],z=me(()=>{const a=new Date,e=o=>String(o).padStart(2,"0");return`${a.getFullYear()}-${e(a.getMonth()+1)}-${e(a.getDate())}T${e(a.getHours())}:${e(a.getMinutes())}`}),B=u(""),F=u(""),R=u(""),H=u(""),y=u(""),V=u(""),M=u([]),b=u(null),s=u(""),g=u(""),k=u(""),w=u(""),C=u(""),c=u(""),f=u(""),x=u(""),T=u(""),D=u(!1),$=u(!1),Z=async()=>(await _.get("/api/itemNames")).data,h=async()=>(await _.get("/api/users")).data;function ee(a){g.value=a.item_id,k.value=a.item_name,B.value=a.item_id,F.value=a.item_name,D.value=!1}function le(a){w.value=a.user_id,C.value=a.user_name,R.value=a.user_id,H.value=a.user_name,$.value=!1}function A(a){if(!a)return null;const[e,o]=String(a).split("T");if(!e||!o)return null;const t=o.length===5?`${o}:00`:o;return`${e} ${t}`}function ae(a,e){const o=new Date(a),t=new Date(e);return Math.max(0,Math.round((t-o)/6e4))}async function L(){try{const a={facility_id:B.value||null,emp_id:R.value||null,from_dt:y.value?Y(y.value,"-")+" 00:00:00":null,to_dt:V.value?Y(V.value,"-")+" 23:59:59":null},{data:e}=await _.get("/api/cleanHistList",{params:a});M.value=(e||[]).map(o=>({...o,duration_min:o.clean_start_dt&&o.clean_end_dt?ae(o.clean_start_dt,o.clean_end_dt):null,is_active:o.is_active??"Y"}))}catch(a){console.error(a),d("이력 조회에 실패했습니다","error")}}function te(){B.value="",F.value="",R.value="",H.value="",y.value="",V.value="",M.value=[],b.value=null}ve(b,a=>{a&&(s.value=a.hist_id||"",g.value=a.facility_id||"",k.value=a.facility_name||"",w.value=a.emp_id||"",C.value=a.emp_name||"",c.value=a.clean_start_dt?a.clean_start_dt.replace(" ","T").slice(0,16):"",f.value=a.clean_end_dt?a.clean_end_dt.replace(" ","T").slice(0,16):"",x.value=a.remk||"",T.value="")});function E(){s.value="",g.value="",k.value="",w.value="",C.value="",c.value="",f.value="",x.value="",T.value="",b.value=null}async function ne(){var G,J;if(!g.value||!w.value||!c.value||!f.value){d("필수값을 입력하세요","error");return}const a=new Date(c.value);if(new Date(f.value)<a){d("종료일시는 시작일시 이후여야 합니다","error");return}const o={hist_id:s.value||null,facility_id:Number(g.value),emp_id:w.value,clean_start_dt:A(c.value),clean_end_dt:A(f.value),remk:x.value,edit_reason:s.value&&T.value||null},t=s.value?"정말 정정(수정)하시겠습니까?":"정말 등록하시겠습니까?";if(confirm(t))try{let p;s.value?p=await _.put("/api/cleanHistUpdate",o):p=await _.post("/api/cleanHistInsert",o),console.log(p),(G=p.data)!=null&&G.success?(d(s.value?"정정되었습니다":"등록되었습니다",s.value?"warning":"success"),await L(),E()):d(((J=p.data)==null?void 0:J.error)||"저장 실패","error")}catch(p){console.error(p),d("저장 실패","error")}}async function oe(){if(!s.value)return d("무효 처리할 이력을 선택하세요","warning");if(confirm("정말 이 이력을 무효 처리하시겠습니까?"))try{const{data:a}=await _.patch("/api/cleanHistVoid",{hist_id:s.value,edit_reason:T.value||null});a!=null&&a.success?(d("무효 처리되었습니다","error"),await L(),E()):d((a==null?void 0:a.error)||"무효 처리 실패","error")}catch(a){console.error(a),d("무효 처리 실패","error")}}return(a,e)=>{const o=fe("CardHeader");return X(),W(be,null,[l(O,{elevation:"10"},{default:n(()=>[l(K,{class:"py-6 px-6"},{default:n(()=>[l(ue,{title:"세척이력 조회","btn-text1":"초기화","btn-variant1":"flat","btn-color1":"secondary",onBtnClick1:te,"btn-text2":"조회","btn-variant2":"flat","btn-color2":"primary",onBtnClick2:L}),l(S,null,{default:n(()=>[l(r,{cols:"12",md:"12"},{default:n(()=>[l(S,{justify:"space-between",dense:""},{default:n(()=>[l(r,{cols:"12",sm:"3"},{default:n(()=>[l(m,{label:"설비명",modelValue:F.value,"onUpdate:modelValue":e[1]||(e[1]=t=>F.value=t),variant:"outlined",readonly:""},{"append-inner":n(()=>[l(N,{onClick:e[0]||(e[0]=t=>D.value=!0),class:"cursor-pointer"},{default:n(()=>e[18]||(e[18]=[U("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(r,{cols:"12",sm:"3"},{default:n(()=>[l(m,{label:"담당자",modelValue:H.value,"onUpdate:modelValue":e[3]||(e[3]=t=>H.value=t),variant:"outlined",readonly:""},{"append-inner":n(()=>[l(N,{onClick:e[2]||(e[2]=t=>$.value=!0),class:"cursor-pointer"},{default:n(()=>e[19]||(e[19]=[U("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(r,{cols:"12",sm:"3"},{default:n(()=>[l(m,{type:"date",label:"시작일",modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=t=>y.value=t),max:i(q),variant:"outlined"},null,8,["modelValue","max"])]),_:1}),l(r,{cols:"12",sm:"3"},{default:n(()=>[l(m,{type:"date",label:"종료일",modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=t=>V.value=t),max:i(q),variant:"outlined"},null,8,["modelValue","max"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(O,{elevation:"10",class:"mt-3"},{default:n(()=>[l(K,{class:"py-6 px-6"},{default:n(()=>[l(o,{title:"세척이력 목록"}),l(i(ie),{selection:b.value,"onUpdate:selection":e[6]||(e[6]=t=>b.value=t),value:M.value,selectionMode:"single",metaKeySelection:!1,dataKey:"hist_id",paginator:"",rows:10,tableStyle:"min-width: 60rem",class:"cursor-pointer"},{default:n(()=>[l(i(v),{field:"hist_id",header:"ID"}),l(i(v),{field:"facility_name",header:"설비명"}),l(i(v),{field:"emp_name",header:"담당자"}),l(i(v),{field:"clean_start_dt",header:"시작일시"}),l(i(v),{field:"clean_end_dt",header:"종료일시"}),l(i(v),{field:"duration_min",header:"소요(분)"}),l(i(v),{field:"remk",header:"비고"}),l(i(v),{field:"clean_status",header:"상태"})]),_:1},8,["selection","value"]),M.value.length?ce("",!0):(X(),W("p",ge,"조회 결과가 없습니다."))]),_:1})]),_:1}),l(O,{elevation:"10",class:"mt-3"},{default:n(()=>[l(K,{class:"py-6 px-6"},{default:n(()=>[l(se,{title:s.value?"세척이력 정정":"세척이력 등록","btn-text1":"초기화","btn-variant1":"flat","btn-color1":"secondary",onBtnClick1:E,"btn-text2":"무효","btn-variant2":"flat","btn-color2":"error","btn-disabled2":!s.value,onBtnClick2:oe,"btn-text3":"저장","btn-variant3":"flat","btn-color3":"primary",onBtnClick3:ne},null,8,["title","btn-disabled2"]),l(S,{dense:""},{default:n(()=>[l(r,{cols:"12",sm:"4"},{default:n(()=>[l(m,{label:"설비명",modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=t=>k.value=t),variant:"outlined",readonly:""},{"append-inner":n(()=>[l(N,{onClick:e[7]||(e[7]=t=>D.value=!0),class:"cursor-pointer"},{default:n(()=>e[20]||(e[20]=[U("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(r,{cols:"12",sm:"4"},{default:n(()=>[l(m,{label:"담당자",modelValue:C.value,"onUpdate:modelValue":e[10]||(e[10]=t=>C.value=t),variant:"outlined",readonly:""},{"append-inner":n(()=>[l(N,{onClick:e[9]||(e[9]=t=>$.value=!0),class:"cursor-pointer"},{default:n(()=>e[21]||(e[21]=[U("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(r,{cols:"12",sm:"4"},{default:n(()=>[l(m,{label:"이력ID",modelValue:s.value,"onUpdate:modelValue":e[11]||(e[11]=t=>s.value=t),variant:"outlined",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),l(S,{dense:""},{default:n(()=>[l(r,{cols:"12",sm:"6"},{default:n(()=>[l(m,{type:"datetime-local",label:"세척 시작일시",modelValue:c.value,"onUpdate:modelValue":e[12]||(e[12]=t=>c.value=t),max:z.value,variant:"outlined"},null,8,["modelValue","max"])]),_:1}),l(r,{cols:"12",sm:"6"},{default:n(()=>[l(m,{type:"datetime-local",label:"세척 종료일시",modelValue:f.value,"onUpdate:modelValue":e[13]||(e[13]=t=>f.value=t),max:z.value,variant:"outlined"},null,8,["modelValue","max"])]),_:1})]),_:1}),l(S,{dense:""},{default:n(()=>[l(r,{cols:"12"},{default:n(()=>[l(pe,{label:"비고",modelValue:x.value,"onUpdate:modelValue":e[14]||(e[14]=t=>x.value=t),outlined:"",rows:"4"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(P,{visible:D.value,title:"설비명",idField:"item_id",columns:[{key:"item_id",label:"ID"},{key:"item_name",label:"설비명"}],fetchData:Z,onSelect:ee,onClose:e[15]||(e[15]=t=>D.value=!1)},null,8,["visible"]),l(P,{visible:$.value,title:"담당자",idField:"user_id",columns:[{key:"user_id",label:"ID"},{key:"user_name",label:"이름"}],fetchData:h,onSelect:le,onClose:e[16]||(e[16]=t=>$.value=!1)},null,8,["visible"]),l(Ve,{modelValue:i(I),"onUpdate:modelValue":e[17]||(e[17]=t=>ye(I)?I.value=t:null),color:i(Q),timeout:"2000",location:"top right"},{default:n(()=>[U(_e(i(j)),1)]),_:1},8,["modelValue","color"])],64)}}};export{Fe as default};
