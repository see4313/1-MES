import{_ as h}from"./card-header-btn-CibSipEU.js";import{_ as ee}from"./card-header-btn2-3eeFV3jL.js";import{s as le,a as r}from"./index-DzeG4XAE.js";import{_ as I}from"./CommonModal-DAUXa4tk.js";import{a as D}from"./index-NIGUFBhG.js";import{d as q}from"./dayjs.min-CQa8u9th.js";import{_ as ae}from"./SnackBar-HH3n22ps.js";import{u as te}from"./useSnackBar-IN_qynCK.js";import{r as o,m as ne,M as F,c as oe,o as ue,b as l,w as t,Q as N,T as y,U as m,ac as f,a0 as M,d as c,x as R,ap as T,s as z,u as s,al as de,N as j,a as se,t as L,V as ie,F as re}from"./index-vUQOwfGq.js";import"./_commonjsHelpers-gnU0ypJ3.js";const me={class:"card"},ge={__name:"MT-003",setup(pe){const{snackBar:i}=te(),u=o([]),Q=q().format("YYYY-MM-DD"),$=o(!1),p=o(null),C=o(!1),v=o(null),U=o(!1),S=o(!1),V=o(!1),b=o(null),_=o(null),x=o(null),w=o(null),k=o(null),g=o(null);ne(()=>{});const Y=F(()=>p.value?q(p.value).format("YYYY-MM-DD"):""),B=F(()=>v.value?q(v.value).format("YYYY-MM-DD"):""),A=async()=>{try{return(await D.get("/api/selectVend")).data}catch{return i("조회 실패.","error"),[]}},G=async()=>{try{const n={dept_id:"D002"};return(await D.get("/api/selectEmp",{params:n})).data}catch{return i("조회 실패.","error"),[]}},H=async()=>{try{const n={item_type:"원재료",uon:"Y"};return(await D.get("/api/itemList",{params:n})).data}catch{return i("조회 실패.","error"),[]}},J=n=>{b.value=n.vend_id,_.value=n.vend_name},K=n=>{x.value=n.emp_id,w.value=n.emp_name},O=n=>{if(k.value!=null){const e=u.value[k.value];e.item_id=n.item_id,e.item_name=n.item_name,e.unit=n.unit,e.spec=n.spec,V.value=!1,k.value=null}},W=()=>{u.value.push({item_id:"",item_name:"",unit:"",spec:"",qty:0,untpc:0,totpc:0})},X=n=>{k.value=n,V.value=!0},Z=n=>{confirm("삭제하시겠습니까?")&&u.value.splice(n,1)},E=()=>{b.value=null,_.value=null,x.value=null,w.value=null,p.value=null,v.value=null,g.value=null},P=async()=>{if(!b.value||!x.value||!Y.value||!B.value){i("모든 항목을 입력해주세요.","warning");return}if(!u.value||u.value.length===0){i("상세 항목을 하나 이상 선택해주세요.","warning");return}if(u.value.find(e=>!e.item_id||!e.qty||e.qty<=0||!e.untpc||e.untpc<=0)){i("품목의 항목을 올바르게 입력해주세요.","warning");return}if(confirm("등록하시겠습니까?"))try{const e={vend_id:b.value,emp_id:x.value,reg_date:Y.value,pap_date:B.value,remark:g.value,details:u.value.map(d=>({item_id:d.item_id,qty:d.qty,untpc:d.untpc}))};(await D.post("/api/procInsert",e)).data.result?(i("등록 성공","success"),E(),u.value=[]):i("등록 실패.","error")}catch{i("에러","error")}};return(n,e)=>(ue(),oe(re,null,[l(j,{elevation:"10"},{default:t(()=>[l(N,{class:"py-6 px-6"},{default:t(()=>[l(ee,{title:"발주 등록","btn-text1":"초기화","btn-variant1":"flat","btn-color1":"secondary",onBtnClick1:e[0]||(e[0]=a=>E()),"btn-text2":"등록","btn-variant2":"flat","btn-color2":"primary",onBtnClick2:e[1]||(e[1]=a=>P())}),l(y,null,{default:t(()=>[l(m,{cols:"12",md:"8"},{default:t(()=>[l(y,{justify:"space-between",dense:""},{default:t(()=>[l(m,{cols:"12",sm:"6"},{default:t(()=>[l(f,{label:"업체명",modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=a=>_.value=a),variant:"outlined",readonly:""},{"append-inner":t(()=>[l(M,{onClick:e[2]||(e[2]=a=>U.value=!0),class:"cursor-pointer"},{default:t(()=>e[19]||(e[19]=[c("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(m,{cols:"12",sm:"6"},{default:t(()=>[l(f,{label:"담당자",modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=a=>w.value=a),variant:"outlined",readonly:""},{"append-inner":t(()=>[l(M,{onClick:e[4]||(e[4]=a=>S.value=!0),class:"cursor-pointer"},{default:t(()=>e[20]||(e[20]=[c("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(y,{justify:"space-between",dense:""},{default:t(()=>[l(m,{cols:"12",sm:"6"},{default:t(()=>[l(R,{modelValue:$.value,"onUpdate:modelValue":e[9]||(e[9]=a=>$.value=a),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:t(({props:a})=>[l(f,z(a,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=d=>p.value=d),label:"발주일자","append-inner-icon":"mdi-calendar",readonly:"",variant:"outlined","model-value":Y.value}),null,16,["modelValue","model-value"])]),default:t(()=>[l(T,{modelValue:p.value,"onUpdate:modelValue":[e[7]||(e[7]=a=>p.value=a),e[8]||(e[8]=a=>$.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(m,{cols:"12",sm:"6"},{default:t(()=>[l(R,{modelValue:C.value,"onUpdate:modelValue":e[13]||(e[13]=a=>C.value=a),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:t(({props:a})=>[l(f,z(a,{modelValue:v.value,"onUpdate:modelValue":e[10]||(e[10]=d=>v.value=d),label:"납기일자","append-inner-icon":"mdi-calendar",readonly:"",variant:"outlined","model-value":B.value}),null,16,["modelValue","model-value"])]),default:t(()=>[l(T,{modelValue:v.value,"onUpdate:modelValue":[e[11]||(e[11]=a=>v.value=a),e[12]||(e[12]=a=>C.value=!1)],min:s(Q)},null,8,["modelValue","min"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,{cols:"12",md:"4"},{default:t(()=>[l(y,null,{default:t(()=>[l(m,{cols:"12"},{default:t(()=>[l(de,{label:"비고",modelValue:g.value,"onUpdate:modelValue":e[14]||(e[14]=a=>g.value=a),outlined:"",rows:"5"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(j,{elevation:"10",class:"mt-3"},{default:t(()=>[l(N,{class:"py-6 px-6"},{default:t(()=>[l(h,{title:"발주 상세","btn-text":"행 추가","btn-variant":"flat","btn-color":"#424242",onBtnClick:e[15]||(e[15]=a=>W())}),l(y,null,{default:t(()=>[l(m,{cols:"12",md:"12"},{default:t(()=>[se("div",me,[l(s(le),{value:u.value,paginator:"",rows:10,tableStyle:"min-width: 50rem; table-layout: fixed;"},{default:t(()=>[l(s(r),{header:"품목번호",style:{width:"180px"}},{body:t(a=>[c(L(a.data.item_id)+" ",1),l(M,{small:"",class:"ml-2 cursor-pointer",onClick:d=>X(a.index)},{default:t(()=>e[21]||(e[21]=[c("mdi-magnify")])),_:2},1032,["onClick"])]),_:1}),l(s(r),{field:"item_name",header:"품목명",style:{width:"200px"}}),l(s(r),{field:"spec",header:"규격",style:{width:"150px"}}),l(s(r),{field:"unit",header:"단위",style:{width:"100px"}}),l(s(r),{header:"수량",style:{width:"100px"}},{body:t(a=>[l(f,{modelValue:u.value[a.index].qty,"onUpdate:modelValue":d=>u.value[a.index].qty=d,modelModifiers:{number:!0},type:"number",dense:"","hide-details":"",style:{width:"100px"},variant:"outlined",min:"0"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(s(r),{header:"단가",style:{width:"120px"}},{body:t(a=>[l(f,{modelValue:u.value[a.index].untpc,"onUpdate:modelValue":d=>u.value[a.index].untpc=d,modelModifiers:{number:!0},type:"number",dense:"","hide-details":"",style:{width:"120px"},variant:"outlined",min:"0"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(s(r),{header:"금액(원)",style:{width:"150px"}},{body:t(a=>[c(L((a.data.qty*a.data.untpc).toLocaleString()),1)]),_:1}),l(s(r),{style:{width:"80px","text-align":"center"}},{body:t(a=>[l(ie,{icon:"",color:"error",onClick:d=>Z(a.index)},{default:t(()=>[l(M,{size:"20"},{default:t(()=>e[22]||(e[22]=[c("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["value"])])]),_:1})]),_:1})]),_:1})]),_:1}),l(I,{visible:U.value,title:"거래처",idField:"vend_id",columns:[{key:"vend_id",label:"거래처번호"},{key:"vend_name",label:"거래처명"}],fetchData:A,pageSize:5,onSelect:J,onClose:e[16]||(e[16]=a=>U.value=!1)},null,8,["visible"]),l(I,{visible:S.value,title:"사원",idField:"emd_id",columns:[{key:"emp_id",label:"사원번호"},{key:"emp_name",label:"사원이름"}],fetchData:G,pageSize:5,onSelect:K,onClose:e[17]||(e[17]=a=>S.value=!1)},null,8,["visible"]),l(I,{visible:V.value,title:"품목",idField:"item_id",columns:[{key:"item_id",label:"품목번호"},{key:"item_name",label:"품목명"},{key:"unit",label:"단위"},{key:"spec",label:"규격"}],fetchData:H,pageSize:5,onSelect:O,onClose:e[18]||(e[18]=a=>V.value=!1)},null,8,["visible"]),l(ae)],64))}};export{ge as default};
