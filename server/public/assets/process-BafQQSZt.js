import{r as i,m as K,D as Q,c as J,o as W,b as a,w as t,N as x,Q as M,U as c,T as y,ac as V,aj as q,aq as L,a as C,ar as _,u as b,d as A,t as X,V as Z,an as ee,F as ae,c0 as Y}from"./index-vUQOwfGq.js";import{_ as se}from"./CommonModal-DAUXa4tk.js";import{a as g}from"./index-NIGUFBhG.js";import{_ as le}from"./card-header-btn3k-6zMLpEnU.js";import{_ as te}from"./card-header-btn2k-CzsbA5Hq.js";import{s as oe,a as w}from"./index-DzeG4XAE.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={style:{display:"flex","align-items":"center",gap:"16px","margin-top":"-16px"}},ie={class:"card"},ue={style:{display:"flex","align-items":"center",gap:"16px","margin-top":"-16px"}},ce={__name:"process",setup(pe){const S=i([]),d=i(null);K(()=>{v()});const u=i({prscNo:"",prcsName:"",useYn:""}),o=i({prscNo:"",prcsName:"",useYn:"",remark:""}),N=i(!1),T=i(""),U=i("success"),r=(s,e="success")=>{T.value=s,U.value=e,N.value=!0},m=i(!1),P=i("search"),B=async()=>{var s,e;m.value=!1,await Y(),(e=(s=document.activeElement)==null?void 0:s.blur)==null||e.call(s)},R=async(s="",e="search")=>{await B(),P.value=e,await Y(),m.value=!0},O=s=>{const e=P.value==="create"?o:u;e.value.prcsName=(s==null?void 0:s.type_name)??"",m.value=!1},h=async()=>{try{return(await g.get("/api/processTypes")).data}catch(s){return console.error("조회 실패",s),[]}},v=async()=>{try{const{data:s}=await g.get("/api/processList",{params:{...u.value}});S.value=Array.isArray(s)?s:s.items??[]}catch(s){console.error("조회 실패",s),r("조회 중 오류가 발생했습니다.","error")}};Q(d,s=>{if(!s)return $();o.value={prscNo:s.prscNo??"",prcsName:s.prcsName??"",useYn:s.useYn??"",remark:s.remark??""}});const E=s=>!!(s.prcsName&&s.useYn),F=i(!1),j=encodeURIComponent,z=async()=>{var l,f,n;if(!E(o.value)){r("필수 항목(공정번호/공정명/사용여부)을 확인하세요.","warning");return}const s=!!o.value.prscNo,e={...o.value};if(!(!s&&!window.confirm("등록하시겠습니까?")))try{F.value=!0,s?(await g.put(`/api/process/${j(o.value.prscNo)}`,e),r("수정이 완료되었습니다.","success")):(await g.post("/api/process",e),r("등록이 완료되었습니다.","success")),await v()}catch(p){const I=(l=p==null?void 0:p.response)==null?void 0:l.status,k=(n=(f=p==null?void 0:p.response)==null?void 0:f.data)==null?void 0:n.message;s?r(k||"수정 중 오류가 발생했습니다.","error"):I===409?r(k||"이미 등록된 공정입니다!","warning"):I===400?r(k||"입력값을 확인하세요.","warning"):r(k||"등록 중 오류가 발생했습니다.","error")}finally{F.value=!1}};function $(){o.value={prscNo:"",prcsName:"",useYn:"",procsSeq:"",remark:""}}const D=async()=>{$(),await B()},G=async()=>{u.value={prscNo:"",prcsName:"",useYn:"",procsSeq:""},await Y(),await v()},H=async()=>{var e,l,f;const s=(e=d.value)==null?void 0:e.prscNo;if(console.log("삭제 시도 ID:",s,d.value),!s)return r("삭제할 공정을 선택해주세요.","warning");if(confirm("삭제하시겠습니까?"))try{const{data:n}=await g.delete("/api/processDelete",{data:{prscNo:s}});if(!(n!=null&&n.result))return r((n==null?void 0:n.message)||"삭제에 실패했습니다.","warning");r("삭제되었습니다.","success"),await v(),D()}catch(n){r(((f=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:f.message)||"삭제 중 오류가 발생했습니다.","error")}};return(s,e)=>(W(),J(ae,null,[a(y,null,{default:t(()=>[a(x,{elevation:"10",class:"pa-6"},{default:t(()=>[a(M,{class:"py-6 px-6"},{default:t(()=>[a(te,{title:"공정정보 관리","btn-text2":"조회","btn-color2":"primary","btn-variant2":"flat",onBtnClick2:v,"btn-text1":"초기화","btn-color1":"secondary","btn-variant1":"flat",onBtnClick1:G})]),_:1}),a(c,{cols:"12",md:"12"},{default:t(()=>[a(y,{dense:""},{default:t(()=>[a(c,{cols:"12",sm:"4"},{default:t(()=>[a(V,{variant:"outlined",label:"공정번호",modelValue:u.value.prcsNo,"onUpdate:modelValue":e[0]||(e[0]=l=>u.value.prcsNo=l)},null,8,["modelValue"])]),_:1}),a(c,{cols:"12",sm:"4"},{default:t(()=>[a(V,{variant:"outlined",label:"공정명",modelValue:u.value.prcsName,"onUpdate:modelValue":e[1]||(e[1]=l=>u.value.prcsName=l),"append-inner-icon":"mdi-magnify","onClick:appendInner":e[2]||(e[2]=q(l=>R("processType","search"),["stop"])),readonly:""},null,8,["modelValue"])]),_:1}),a(c,{cols:"12",sm:"4"},{default:t(()=>[a(L,{modelValue:u.value.useYn,"onUpdate:modelValue":e[3]||(e[3]=l=>u.value.useYn=l),label:"사용여부",variant:"outlined",style:{width:"100%","--v-input-gap":"4px"}},{default:t(()=>[C("div",re,[a(_,{label:"사용",value:"Y"}),a(_,{label:"미사용",value:"N"})])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(y,null,{default:t(()=>[a(x,{elevation:"10",class:"pa-6 mt-2"},{default:t(()=>[a(c,{cols:"12"},{default:t(()=>[C("div",ie,[a(b(oe),{value:S.value,selection:d.value,"onUpdate:selection":e[4]||(e[4]=l=>d.value=l),selectionMode:"single",dataKey:"prscNo",tableStyle:"min-width: 50rem",rowHover:"",paginator:!0,rows:5,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"RowsPerPageDropdown PrevPageLink PageLinks NextPageLink"},{default:t(()=>[a(b(w),{field:"prscNo",sortable:"",header:"공정번호"}),a(b(w),{field:"prcsName",header:"공정명"}),a(b(w),{field:"useYn",header:"사용여부"}),a(b(w),{field:"remark",header:"비고"})]),_:1},8,["value","selection"])])]),_:1})]),_:1})]),_:1}),a(y,null,{default:t(()=>[a(x,{elevation:"10",class:"pa-6 mt-2"},{default:t(()=>[a(M,{class:"py-6 px-6"},{default:t(()=>[a(le,{title:"공정정보 등록","btn-text3":"저장","btn-color3":"warning","btn-variant3":"flat",onBtnClick3:z,"btn-text2":"삭제","btn-variant2":"flat","btn-color2":"error","btn-disabled2":!o.value.prscNo,onBtnClick2:H,"btn-text1":"초기화","btn-color1":"secondary","btn-variant1":"flat",onBtnClick1:D},null,8,["btn-disabled2"])]),_:1}),a(c,{cols:"12",md:"12"},{default:t(()=>[a(y,{dense:""},{default:t(()=>[a(c,{cols:"12",sm:"4"},{default:t(()=>[a(V,{variant:"outlined",label:"공정명",modelValue:o.value.prcsName,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.prcsName=l),"append-inner-icon":"mdi-magnify","onClick:appendInner":e[6]||(e[6]=q(l=>R("processType","create"),["stop"]))},null,8,["modelValue"])]),_:1}),a(c,{cols:"12",sm:"4"},{default:t(()=>[a(L,{modelValue:o.value.useYn,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.useYn=l),label:"사용여부",variant:"outlined",style:{width:"100%","--v-input-gap":"4px"}},{default:t(()=>[C("div",ue,[a(_,{label:"사용",value:"Y"}),a(_,{label:"미사용",value:"N"})])]),_:1},8,["modelValue"])]),_:1}),a(c,{cols:"12",sm:"4"},{default:t(()=>[a(V,{variant:"outlined",label:"비고",modelValue:o.value.remark,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.remark=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(ee,{modelValue:N.value,"onUpdate:modelValue":e[10]||(e[10]=l=>N.value=l),timeout:2e3,color:U.value,location:"top right",rounded:"pill"},{actions:t(()=>[a(Z,{variant:"text",onClick:e[9]||(e[9]=l=>N.value=!1)},{default:t(()=>e[12]||(e[12]=[A("닫기")])),_:1})]),default:t(()=>[A(X(T.value)+" ",1)]),_:1},8,["modelValue","color"]),a(se,{visible:m.value,"onUpdate:visible":e[11]||(e[11]=l=>m.value=l),title:"공정 검색",idField:"process_type",columns:[{key:"",label:""},{key:"type_name",label:"공정명"}],fetchData:h,pageSize:10,onSelect:O},null,8,["visible"])],64))}},Ne=ne(ce,[["__scopeId","data-v-3f921dda"]]);export{Ne as default};
