import{a as g}from"./index-NIGUFBhG.js";import{_ as $e}from"./card-header-btn2-BNncrG3u.js";import{_ as De}from"./card-header-btn3k-B0xKRUFF.js";import{s as Se,a as m}from"./index-C6cMUqqj.js";import{_ as X}from"./CommonModal-eUFOkW9R.js";import{u as we}from"./useSnackBar-CsLaRa2S.js";import{u as Ce}from"./useFormatDate-DuO0KNBS.js";import{M as ne,r as n,D as Ie,c as se,o as oe,b as a,w as u,Q as Z,T as S,U as s,ac as d,a0 as w,d as y,P as xe,u as o,N as h,i as Ue,y as Ne,h as Fe,t as ie,aq as Me,ar as de,al as Re,am as Te,an as Ke,F as Oe}from"./index-BkcQ_3tW.js";const Be={key:0,class:"text-grey mt-3"},Pe={__name:"Manage",setup(Ge){const{formatDate:ee}=Ce(),{snackOpen:G,snackMessage:le,snackColor:ae}=we(),v=(l,e="success")=>{le.value=l,ae.value=e,G.value=!0},te=new Date().toISOString().split("T")[0],re=ne(()=>{const l=new Date,e=i=>String(i).padStart(2,"0");return`${l.getFullYear()}-${e(l.getMonth()+1)}-${e(l.getDate())}T${e(l.getHours())}:${e(l.getMinutes())}`}),E=n(!1),H=n(!1),L=n(!1),Y=n(""),C=n(""),J=n(""),I=n(""),Q=n(""),j=n(""),q=n(""),_=n(null),b=n(null),z=n([]),k=n(null),r=n(""),x=n(""),U=n(""),N=n(""),F=n(""),M=n(""),R=n(""),$=n(""),f=n(null),p=n(null),P=n(""),c=n(""),V=n("OK"),D=n(""),T=n(""),ve=ne(()=>{if(f.value!=null||p.value!=null){const l=f.value??"-",e=p.value??"-";return`${l} ~ ${e}`}return P.value||""}),K=n(!1),O=n(!1),B=n(!1),me=async()=>(await g.get("http://localhost:3000/facilityList")).data,fe=async()=>(await g.get("/api/users")).data,pe=async()=>(await g.get("/api/inspectItems")).data;function ce(l){if(!l)return"";const e=new Date(l),i=t=>String(t).padStart(2,"0");return`${e.getFullYear()}-${i(e.getMonth()+1)}-${i(e.getDate())} ${i(e.getHours())}:${i(e.getMinutes())}:${i(e.getSeconds())}`}function ue(){if(c.value===""||c.value===null)return;const l=Number(c.value);!isNaN(l)&&(f.value!=null||p.value!=null)&&(f.value!=null&&l<Number(f.value)||p.value!=null&&l>Number(p.value)?V.value="NG":V.value="OK")}async function A(){try{if(_.value&&b.value&&_.value>b.value){v("시작일이 종료일보다 클 수 없습니다","error");return}E.value=!0;const l={facility_id:Y.value||null,emp_id:J.value||null,inspect_item_id:Q.value||null,result:q.value||null,from_dt:_.value?`${ee(_.value,"-")} 00:00:00`:null,to_dt:b.value?`${ee(b.value,"-")} 23:59:59`:null},{data:e}=await g.get("/api/inspectHist",{params:l});z.value=e||[]}catch(l){console.error(l),v("점검 이력 조회 실패","error")}finally{E.value=!1}}function ye(){Y.value="",C.value="",J.value="",I.value="",Q.value="",j.value="",q.value="",_.value=null,b.value=null,z.value=[],k.value=null}function _e(l){x.value=l.facility_id,U.value=l.facility_name,Y.value=l.facility_id,C.value=l.facility_name,K.value=!1}function be(l){N.value=l.user_id,F.value=l.user_name,J.value=l.user_id,I.value=l.user_name,O.value=!1}function Ve(l){M.value=l.inspect_item_id,R.value=l.inspect_item_name,$.value=l.unit_name||"",f.value=l.std_lower??null,p.value=l.std_upper??null,P.value=l.std_val||"",B.value=!1,ue()}Ie(k,l=>{l&&(r.value=l.inspect_id||"",x.value=l.facility_id||"",U.value=l.facility_name||"",N.value=l.emp_id||"",F.value=l.emp_name||"",M.value=l.inspect_item_id||"",R.value=l.inspect_item_name||"",$.value=l.unit_name||"",f.value=l.std_lower??null,p.value=l.std_upper??null,P.value=l.std_val||"",D.value=l.inspect_dt?l.inspect_dt.replace(" ","T").slice(0,16):"",c.value=l.measure_val??"",V.value=l.result||"OK",T.value=l.remk||"")});function W(){r.value="",x.value=Y.value,U.value=C.value,N.value=J.value,F.value=I.value,M.value=Q.value,R.value=j.value,$.value="",f.value=null,p.value=null,P.value="";const l=new Date,e=i=>String(i).padStart(2,"0");D.value=`${l.getFullYear()}-${e(l.getMonth()+1)}-${e(l.getDate())}T${e(l.getHours())}:${e(l.getMinutes())}`,c.value="",V.value="OK",T.value="",k.value=null}async function ge(){var e,i;if(!x.value||!N.value||!M.value||!D.value){v("필수값을 입력하세요","error");return}if(H.value)return;H.value=!0;const l={inspect_id:r.value||null,facility_id:x.value,emp_id:N.value,inspect_item_id:M.value,inspect_dt:ce(D.value),measure_val:c.value,unit_name:$.value||null,result:V.value,remk:T.value};try{const t=r.value?await g.put("/api/inspectUpdate",l):await g.post("/api/inspectInsert",l);(e=t.data)!=null&&e.success?(v(r.value?"수정되었습니다":"등록되었습니다",r.value?"warning":"success"),await A(),W()):v(((i=t.data)==null?void 0:i.error)||"저장 실패","error")}catch(t){console.error(t),v("저장 실패","error")}finally{H.value=!1}}async function ke(){if(!r.value)return v("삭제할 건을 선택하세요","warning");if(confirm("정말 삭제하시겠습니까?")&&!L.value){L.value=!0;try{const{data:l}=await g.delete("/api/inspectDelete",{data:{inspect_id:r.value}});l!=null&&l.success?(v("삭제되었습니다","error"),await A(),W()):v((l==null?void 0:l.error)||"삭제 실패","error")}catch(l){console.error(l),v("삭제 실패","error")}finally{L.value=!1}}}return(l,e)=>{const i=Ne("CardHeader");return oe(),se(Oe,null,[a(h,{elevation:"10"},{default:u(()=>[a(Z,{class:"py-6 px-6"},{default:u(()=>[a($e,{title:"점검 이력 조회","btn-text1":"초기화","btn-variant1":"flat","btn-color1":"secondary",onBtnClick1:ye,"btn-text2":"조회","btn-variant2":"flat","btn-color2":"primary",onBtnClick2:A}),a(S,null,{default:u(()=>[a(s,{cols:"12",md:"12"},{default:u(()=>[a(S,{justify:"space-between",dense:""},{default:u(()=>[a(s,{cols:"12",sm:"3"},{default:u(()=>[a(d,{label:"설비명",modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=t=>C.value=t),variant:"outlined",readonly:""},{"append-inner":u(()=>[a(w,{class:"cursor-pointer",onClick:e[0]||(e[0]=t=>K.value=!0)},{default:u(()=>e[27]||(e[27]=[y("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a(s,{cols:"12",sm:"3"},{default:u(()=>[a(d,{label:"담당자",modelValue:I.value,"onUpdate:modelValue":e[3]||(e[3]=t=>I.value=t),variant:"outlined",readonly:""},{"append-inner":u(()=>[a(w,{class:"cursor-pointer",onClick:e[2]||(e[2]=t=>O.value=!0)},{default:u(()=>e[28]||(e[28]=[y("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a(s,{cols:"12",sm:"3"},{default:u(()=>[a(d,{label:"점검 항목",modelValue:j.value,"onUpdate:modelValue":e[5]||(e[5]=t=>j.value=t),variant:"outlined",readonly:""},{"append-inner":u(()=>[a(w,{class:"cursor-pointer",onClick:e[4]||(e[4]=t=>B.value=!0)},{default:u(()=>e[29]||(e[29]=[y("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a(s,{cols:"12",sm:"3"},{default:u(()=>[a(xe,{label:"판정",modelValue:q.value,"onUpdate:modelValue":e[6]||(e[6]=t=>q.value=t),items:[{title:"전체",value:""},{title:"적합(OK)",value:"OK"},{title:"부적합(NG)",value:"NG"}],variant:"outlined"},null,8,["modelValue"])]),_:1}),a(s,{cols:"12",sm:"3"},{default:u(()=>[a(d,{type:"date",label:"시작일",modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=t=>_.value=t),max:o(te),variant:"outlined"},null,8,["modelValue","max"])]),_:1}),a(s,{cols:"12",sm:"3"},{default:u(()=>[a(d,{type:"date",label:"종료일",modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=t=>b.value=t),max:o(te),variant:"outlined"},null,8,["modelValue","max"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(h,{elevation:"10",class:"mt-3"},{default:u(()=>[a(Z,{class:"py-6 px-6"},{default:u(()=>[a(i,{title:"점검 이력 목록"}),a(o(Se),{selection:k.value,"onUpdate:selection":e[9]||(e[9]=t=>k.value=t),value:z.value,selectionMode:"single",metaKeySelection:!1,dataKey:"inspect_id",paginator:"",rows:10,loading:E.value,tableStyle:"min-width: 64rem",class:"cursor-pointer",onRowDblclick:e[10]||(e[10]=({data:t})=>{k.value=t})},{default:u(()=>[a(o(m),{field:"inspect_id",header:"ID"}),a(o(m),{field:"facility_name",header:"설비명"}),a(o(m),{field:"emp_name",header:"담당자"}),a(o(m),{field:"inspect_item_name",header:"점검 항목"}),a(o(m),{field:"measure_val",header:"측정값"}),a(o(m),{field:"unit_name",header:"단위"}),a(o(m),{header:"판정"},{body:u(({data:t})=>[a(Fe,{size:"small",color:t.result==="적합"?"success":"error",variant:"flat"},{default:u(()=>[y(ie(t.JUDGE_RESULT),1)]),_:2},1032,["color"])]),_:1}),a(o(m),{field:"inspect_dt",header:"점검일시"}),a(o(m),{field:"remk",header:"비고"})]),_:1},8,["selection","value","loading"]),!z.value.length&&!E.value?(oe(),se("p",Be,"조회 결과가 없습니다.")):Ue("",!0)]),_:1})]),_:1}),a(h,{elevation:"10",class:"mt-3"},{default:u(()=>[a(Z,{class:"py-6 px-6"},{default:u(()=>[a(De,{title:r.value?"점검 이력 수정":"점검 이력 등록","btn-text1":"초기화","btn-variant1":"flat","btn-color1":"secondary",onBtnClick1:W,"btn-text2":"삭제","btn-variant2":"flat","btn-color2":"error","btn-disabled2":!r.value||L.value,onBtnClick2:ke,"btn-text3":"저장","btn-variant3":"flat","btn-color3":"primary","btn-disabled3":H.value,onBtnClick3:ge},null,8,["title","btn-disabled2","btn-disabled3"]),a(S,{dense:""},{default:u(()=>[a(s,{cols:"12",sm:"4"},{default:u(()=>[a(d,{label:"설비명",modelValue:U.value,"onUpdate:modelValue":e[12]||(e[12]=t=>U.value=t),variant:"outlined",readonly:""},{"append-inner":u(()=>[a(w,{class:"cursor-pointer",onClick:e[11]||(e[11]=t=>K.value=!0)},{default:u(()=>e[30]||(e[30]=[y("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a(s,{cols:"12",sm:"4"},{default:u(()=>[a(d,{label:"담당자",modelValue:F.value,"onUpdate:modelValue":e[14]||(e[14]=t=>F.value=t),variant:"outlined",readonly:""},{"append-inner":u(()=>[a(w,{class:"cursor-pointer",onClick:e[13]||(e[13]=t=>O.value=!0)},{default:u(()=>e[31]||(e[31]=[y("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a(s,{cols:"12",sm:"4"},{default:u(()=>[a(d,{label:"점검 항목",modelValue:R.value,"onUpdate:modelValue":e[16]||(e[16]=t=>R.value=t),variant:"outlined",readonly:""},{"append-inner":u(()=>[a(w,{class:"cursor-pointer",onClick:e[15]||(e[15]=t=>B.value=!0)},{default:u(()=>e[32]||(e[32]=[y("mdi-magnify")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(S,{dense:""},{default:u(()=>[a(s,{cols:"12",sm:"4"},{default:u(()=>[a(d,{label:"이력ID",modelValue:r.value,"onUpdate:modelValue":e[17]||(e[17]=t=>r.value=t),variant:"outlined",readonly:""},null,8,["modelValue"])]),_:1}),a(s,{cols:"12",sm:"4"},{default:u(()=>[a(d,{type:"datetime-local",label:"점검일시",modelValue:D.value,"onUpdate:modelValue":e[18]||(e[18]=t=>D.value=t),max:re.value,variant:"outlined"},null,8,["modelValue","max"])]),_:1}),a(s,{cols:"12",sm:"4"},{default:u(()=>[a(d,{label:"측정값",modelValue:c.value,"onUpdate:modelValue":[e[19]||(e[19]=t=>c.value=t),ue],variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),a(S,{dense:""},{default:u(()=>[a(s,{cols:"12",sm:"4"},{default:u(()=>[a(d,{label:"단위",modelValue:$.value,"onUpdate:modelValue":e[20]||(e[20]=t=>$.value=t),variant:"outlined",readonly:""},null,8,["modelValue"])]),_:1}),a(s,{cols:"12",sm:"8"},{default:u(()=>[a(d,{label:"표준(하한 ~ 상한 / 또는 기준값)","model-value":ve.value,variant:"outlined",readonly:""},null,8,["model-value"])]),_:1})]),_:1}),a(S,{dense:""},{default:u(()=>[a(s,{cols:"12",sm:"6"},{default:u(()=>[a(Me,{modelValue:V.value,"onUpdate:modelValue":e[21]||(e[21]=t=>V.value=t),inline:""},{default:u(()=>[a(de,{label:"적합(OK)",value:"OK"}),a(de,{label:"부적합(NG)",value:"NG"})]),_:1},8,["modelValue"])]),_:1}),a(s,{cols:"12",sm:"6"},{default:u(()=>[a(Re,{label:"비고",modelValue:T.value,"onUpdate:modelValue":e[22]||(e[22]=t=>T.value=t),rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(X,{visible:K.value,title:"설비명",idField:"facility_id",columns:[{key:"facility_id",label:"ID"},{key:"facility_name",label:"설비명"}],fetchData:me,onSelect:_e,onClose:e[23]||(e[23]=t=>K.value=!1)},null,8,["visible"]),a(X,{visible:O.value,title:"담당자",idField:"user_id",columns:[{key:"user_id",label:"ID"},{key:"user_name",label:"이름"}],fetchData:fe,onSelect:be,onClose:e[24]||(e[24]=t=>O.value=!1)},null,8,["visible"]),a(X,{visible:B.value,title:"점검 항목",idField:"inspect_item_id",columns:[{key:"inspect_item_id",label:"ID"},{key:"inspect_item_name",label:"항목"},{key:"unit_name",label:"단위"},{key:"std_lower",label:"하한"},{key:"std_upper",label:"상한"},{key:"std_val",label:"기준값"}],fetchData:pe,onSelect:Ve,onClose:e[25]||(e[25]=t=>B.value=!1)},null,8,["visible"]),a(Ke,{modelValue:o(G),"onUpdate:modelValue":e[26]||(e[26]=t=>Te(G)?G.value=t:null),color:o(ae),timeout:"2000",location:"top right"},{default:u(()=>[y(ie(o(le)),1)]),_:1},8,["modelValue","color"])],64)}}};export{Pe as default};
