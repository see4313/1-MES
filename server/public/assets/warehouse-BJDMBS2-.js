import{r as p,m as Q,D as J,c as X,o as Z,b as a,w as t,N as I,Q as F,U as r,T as V,ac as m,aj as _,aq as M,a as C,ar as T,u as c,d as D,t as ee,V as ae,an as le,F as oe,c0 as U}from"./index-BkcQ_3tW.js";import{_ as te}from"./CommonModal-eUFOkW9R.js";import{a as b}from"./index-NIGUFBhG.js";import{_ as se}from"./card-header-btn3k-B0xKRUFF.js";import{_ as ne}from"./card-header-btn2k-BsHGyKI1.js";import{s as ue,a as v}from"./index-C6cMUqqj.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de={style:{display:"flex","align-items":"center",gap:"16px","margin-top":"-16px"}},ie={class:"card"},me={style:{display:"flex","align-items":"center",gap:"16px","margin-top":"-16px"}},pe={__name:"warehouse",setup(ce){const L=p([]),w=p(null);Q(()=>{y()});const u=p({warehouseId:"",warehouseType:"",useYn:"",warehouseName:"",warehouseLoca:"",temp:"",rh:""}),s=p({warehouseId:"",warehouseType:"",useYn:"",warehouseName:"",warehouseLoca:"",remark:"",temp:"",rh:""}),g=p(!1),N=p(""),Y=p("success"),i=(l,e="success")=>{N.value=l,Y.value=e,g.value=!0},h=p(!1),P=p("search"),j=p(null),S=async()=>{var l,e;h.value=!1,await U(),(e=(l=document.activeElement)==null?void 0:l.blur)==null||e.call(l)},R=async(l="warehouseType",e="search")=>{await S(),P.value=e,j.value=l,await U(),l==="warehouseType"?h.value=!0:l==="warehouseLoca"&&(showWhLocaModal.value=!0)};async function W(){var l;(l=window.daum)!=null&&l.Postcode||await new Promise((e,o)=>{const n=document.createElement("script");n.src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js",n.onload=e,document.head.appendChild(n)}),new window.daum.Postcode({oncomplete:e=>{const o=e.userSelectedType==="R"?e.roadAddress:e.jibunAddress,n=prompt("상세주소를 입력하세요","")||"";s.value.warehouseLoca=n?`${o} ${n}`:o}}).open()}const E=l=>{const e=(l==null?void 0:l.cmmn_name)??"";l==null||l.cmmn_id;const o=P.value==="create"?s:u;o.value.warehouseType=e,h.value=!1},O=async({page:l=1,pageSize:e=5,keyword:o=""}={})=>{try{const{data:n}=await b.get("/api/whTypes",{params:{page:l,pageSize:e,keyword:o}});return Array.isArray(n)?n:n.items??[]}catch(n){return console.error("창고유형 조회 실패",n),[]}},y=async()=>{try{const{data:l}=await b.get("/api/warehouseList",{params:{...u.value}});L.value=Array.isArray(l)?l:l.items??[]}catch(l){console.error("조회 실패",l),i("조회 중 오류가 발생했습니다.","error")}};J(w,l=>{if(!l)return x();s.value={warehouseId:l.warehouseId??"",warehouseType:l.warehouseType??"",useYn:l.useYn??"",warehouseName:l.warehouseName??"",warehouseLoca:l.warehouseLoca??"",temp:l.temp??"",rh:l.rh??"",remark:l.remark??""}});const q=l=>!!(l.warehouseName&&l.useYn&&l.warehouseLoca),$=p(!1),z=encodeURIComponent,G=async()=>{var o,n,d;if(!q(s.value)){i("필수 항목을 확인하세요.","warning");return}const l=!!s.value.warehouseId,e={...s.value};if(!(!l&&!window.confirm("등록하시겠습니까?")))try{$.value=!0,l?(await b.put(`/api/warehouses/${z(s.value.warehouseId)}`,e),i("수정이 완료되었습니다.","success")):(await b.post("/api/warehouses",e),i("등록이 완료되었습니다.","success"),w.value=null,x()),await y()}catch(f){const B=(o=f==null?void 0:f.response)==null?void 0:o.status,k=(d=(n=f==null?void 0:f.response)==null?void 0:n.data)==null?void 0:d.message;l?i(k||"수정 중 오류가 발생했습니다.","error"):B===409?i(k||"이미 등록된 창고입니다!","warning"):B===400?i(k||"입력값을 확인하세요.","warning"):i(k||"등록 중 오류가 발생했습니다.","error")}finally{$.value=!1}};function x(){s.value={warehouseId:"",warehouseType:"",useYn:"",warehouseName:"",warehouseLoca:"",remark:"",temp:"",rh:""}}const A=async()=>{x(),w.value=null,await S()},H=async()=>{u.value={warehouseId:"",warehouseType:"",useYn:"",warehouseName:"",warehouseLoca:"",temp:"",rh:""},await U(),await y()},K=async()=>{var e,o,n;const l=(e=w.value)==null?void 0:e.warehouseId;if(console.log("삭제 시도 ID:",l,w.value),!l)return i("삭제할 창고를 선택해주세요.","warning");if(confirm("삭제하시겠습니까?"))try{const{data:d}=await b.delete("/api/warehouseDelete",{data:{whId:l}});if(!(d!=null&&d.result))return i((d==null?void 0:d.message)||"삭제에 실패했습니다.","warning");i("삭제되었습니다.","success"),await y(),A()}catch(d){i(((n=(o=d==null?void 0:d.response)==null?void 0:o.data)==null?void 0:n.message)||"삭제 중 오류가 발생했습니다.","error")}};return(l,e)=>(Z(),X(oe,null,[a(V,null,{default:t(()=>[a(I,{elevation:"10",class:"pa-6"},{default:t(()=>[a(F,{class:"py-6 px-6"},{default:t(()=>[a(ne,{title:"창고관리","btn-text2":"조회","btn-color2":"primary","btn-variant2":"flat",onBtnClick2:y,"btn-text1":"초기화","btn-color1":"secondary","btn-variant1":"flat",onBtnClick1:H})]),_:1}),a(r,{cols:"12",md:"12"},{default:t(()=>[a(V,{dense:""},{default:t(()=>[a(r,{cols:"12",sm:"4"},{default:t(()=>[a(m,{variant:"outlined",label:"창고번호",modelValue:u.value.warehouseId,"onUpdate:modelValue":e[0]||(e[0]=o=>u.value.warehouseId=o)},null,8,["modelValue"])]),_:1}),a(r,{cols:"12",sm:"4"},{default:t(()=>[a(m,{variant:"outlined",label:"창고유형",modelValue:u.value.warehouseType,"onUpdate:modelValue":e[1]||(e[1]=o=>u.value.warehouseType=o),"append-inner-icon":"mdi-magnify","onClick:appendInner":e[2]||(e[2]=_(o=>R("warehouseType","search"),["stop"]))},null,8,["modelValue"])]),_:1}),a(r,{cols:"12",sm:"4"},{default:t(()=>[a(M,{modelValue:u.value.useYn,"onUpdate:modelValue":e[3]||(e[3]=o=>u.value.useYn=o),label:"사용여부",variant:"outlined",style:{width:"100%","--v-input-gap":"4px"}},{default:t(()=>[C("div",de,[a(T,{label:"사용",value:"Y"}),a(T,{label:"미사용",value:"N"})])]),_:1},8,["modelValue"])]),_:1}),a(r,{cols:"12",sm:"4"},{default:t(()=>[a(m,{variant:"outlined",label:"창고명",modelValue:u.value.warehouseName,"onUpdate:modelValue":e[4]||(e[4]=o=>u.value.warehouseName=o)},null,8,["modelValue"])]),_:1}),a(r,{cols:"12",sm:"4"},{default:t(()=>[a(m,{variant:"outlined",label:"온도(℃)",modelValue:u.value.temp,"onUpdate:modelValue":e[5]||(e[5]=o=>u.value.temp=o)},null,8,["modelValue"])]),_:1}),a(r,{cols:"12",sm:"4"},{default:t(()=>[a(m,{variant:"outlined",label:"습도(%)",modelValue:u.value.rh,"onUpdate:modelValue":e[6]||(e[6]=o=>u.value.rh=o)},null,8,["modelValue"])]),_:1}),a(r,{cols:"12",sm:"4"},{default:t(()=>[a(m,{variant:"outlined",label:"창고위치",modelValue:u.value.warehouseLoca,"onUpdate:modelValue":e[7]||(e[7]=o=>u.value.warehouseLoca=o)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(V,null,{default:t(()=>[a(I,{elevation:"10",class:"pa-6 mt-2"},{default:t(()=>[a(r,{cols:"12"},{default:t(()=>[C("div",ie,[a(c(ue),{value:L.value,selection:w.value,"onUpdate:selection":e[8]||(e[8]=o=>w.value=o),selectionMode:"single",dataKey:"warehouseId",tableStyle:"min-width: 50rem",rowHover:"",paginator:!0,rows:5,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"RowsPerPageDropdown PrevPageLink PageLinks NextPageLink"},{default:t(()=>[a(c(v),{field:"warehouseId",sortable:"",header:"창고번호"}),a(c(v),{field:"warehouseType",header:"창고유형"}),a(c(v),{field:"warehouseName",header:"창고명"}),a(c(v),{field:"useYn",header:"사용여부"}),a(c(v),{field:"temp",header:"온도(℃)"}),a(c(v),{field:"rh",header:"습도(%)"}),a(c(v),{field:"warehouseLoca",header:"창고위치"}),a(c(v),{field:"remark",header:"비고"})]),_:1},8,["value","selection"])])]),_:1})]),_:1})]),_:1}),a(V,null,{default:t(()=>[a(I,{elevation:"10",class:"pa-6 mt-2"},{default:t(()=>[a(F,{class:"py-6 px-6"},{default:t(()=>[a(se,{title:"창고등록","btn-text3":"저장","btn-color3":"warning","btn-variant3":"flat",onBtnClick3:G,"btn-text2":"삭제","btn-variant2":"flat","btn-color2":"error","btn-disabled2":!s.value.warehouseId,onBtnClick2:K,"btn-text1":"초기화","btn-color1":"secondary","btn-variant1":"flat",onBtnClick1:A},null,8,["btn-disabled2"])]),_:1}),a(r,{cols:"12",md:"12"},{default:t(()=>[a(V,{dense:""},{default:t(()=>[a(r,{cols:"12",sm:"4"},{default:t(()=>[a(m,{variant:"outlined",label:"창고유형",modelValue:s.value.warehouseType,"onUpdate:modelValue":e[9]||(e[9]=o=>s.value.warehouseType=o),"append-inner-icon":"mdi-magnify","onClick:appendInner":e[10]||(e[10]=_(o=>R("warehouseType","create"),["stop"])),readonly:""},null,8,["modelValue"])]),_:1}),a(r,{cols:"12",sm:"4"},{default:t(()=>[a(m,{variant:"outlined",label:"창고명",modelValue:s.value.warehouseName,"onUpdate:modelValue":e[11]||(e[11]=o=>s.value.warehouseName=o)},null,8,["modelValue"])]),_:1}),a(r,{cols:"12",sm:"4"},{default:t(()=>[a(M,{modelValue:s.value.useYn,"onUpdate:modelValue":e[12]||(e[12]=o=>s.value.useYn=o),label:"사용여부",variant:"outlined",style:{width:"100%","--v-input-gap":"4px"}},{default:t(()=>[C("div",me,[a(T,{label:"사용",value:"Y"}),a(T,{label:"미사용",value:"N"})])]),_:1},8,["modelValue"])]),_:1}),a(r,{cols:"12",sm:"4"},{default:t(()=>[a(m,{variant:"outlined",label:"창고위치",modelValue:s.value.warehouseLoca,"onUpdate:modelValue":e[13]||(e[13]=o=>s.value.warehouseLoca=o),"append-inner-icon":"mdi-magnify","onClick:appendInner":_(W,["stop"]),readonly:""},null,8,["modelValue"])]),_:1}),a(r,{cols:"12",sm:"4"},{default:t(()=>[a(m,{variant:"outlined",label:"온도(℃)",modelValue:s.value.temp,"onUpdate:modelValue":e[14]||(e[14]=o=>s.value.temp=o)},null,8,["modelValue"])]),_:1}),a(r,{cols:"12",sm:"4"},{default:t(()=>[a(m,{variant:"outlined",label:"습도(%)",modelValue:s.value.rh,"onUpdate:modelValue":e[15]||(e[15]=o=>s.value.rh=o)},null,8,["modelValue"])]),_:1}),a(r,{cols:"12",sm:"4"},{default:t(()=>[a(m,{variant:"outlined",label:"비고",modelValue:s.value.remark,"onUpdate:modelValue":e[16]||(e[16]=o=>s.value.remark=o)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(le,{modelValue:g.value,"onUpdate:modelValue":e[18]||(e[18]=o=>g.value=o),timeout:2e3,color:Y.value,location:"top right",rounded:"pill"},{actions:t(()=>[a(ae,{variant:"text",onClick:e[17]||(e[17]=o=>g.value=!1)},{default:t(()=>e[20]||(e[20]=[D("닫기")])),_:1})]),default:t(()=>[D(ee(N.value)+" ",1)]),_:1},8,["modelValue","color"]),a(te,{visible:h.value,"onUpdate:visible":e[19]||(e[19]=o=>h.value=o),title:"창고유형",idField:"warehouse_type",columns:[{key:"cmmn_id",label:"공통코드 번호"},{key:"cmmn_name",label:"공통코드명"}],fetchData:O,pageSize:5,onSelect:E},null,8,["visible"])],64))}},ge=re(pe,[["__scopeId","data-v-b0bb0944"]]);export{ge as default};
