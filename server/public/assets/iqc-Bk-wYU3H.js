import{r,M as c,m as ue,c as se,o as ie,a as j,b as t,w as o,N as B,Q as z,U as s,T as y,ac as i,aj as I,P as H,x as q,ap as P,s as S,u as d,d as A,t as G,V as de,an as re,F as me}from"./index-BkcQ_3tW.js";import{a as b}from"./index-NIGUFBhG.js";import{_ as ve}from"./card-header-btn2k-BsHGyKI1.js";import{_ as pe}from"./card-header-btn3k-B0xKRUFF.js";import{_ as J}from"./CommonModal-eUFOkW9R.js";import{s as fe,a as m}from"./index-C6cMUqqj.js";import{d as D}from"./dayjs.min-CQa8u9th.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-gnU0ypJ3.js";const Ve={class:"card"},ye={__name:"iqc",setup(be){const p=e=>e?e instanceof Date?e:new Date(e):null,N=e=>e?D(e).format("YYYY-MM-DD"):null,_=r([]),u=r({rcvNo:"",itemName:"",result:"전체",fromDate:null,toDate:null}),M=r(!1),U=r(!1),K=c(()=>u.value.fromDate?D(u.value.fromDate).format("YYYY-MM-DD"):""),W=c(()=>u.value.toDate?D(u.value.toDate).format("YYYY-MM-DD"):""),R=c({get:()=>u.value.fromDate,set:e=>u.value.fromDate=p(e)}),T=c({get:()=>u.value.toDate,set:e=>u.value.toDate=p(e)}),n=r({id:null,rcvNo:"",itemId:"",itemName:"",lotNo:"",qty:null,inspDate:null,result:"",inspector:"",badnCode:"",badnName:"",failQty:null,remark:""}),x=r(!1),X=c(()=>n.value.inspDate?D(n.value.inspDate).format("YYYY-MM-DD"):""),$=c({get:()=>n.value.inspDate,set:e=>n.value.inspDate=p(e)}),k=r(!1),F=r(""),O=r("success"),f=(e,l="success")=>{F.value=e,O.value=l,k.value=!0},C=r(!1),g=r(!1),Q=r("search"),L=(e="search")=>{Q.value=e,C.value=!0},Z=()=>{g.value=!0},w=async()=>{try{const{data:e}=await b.get("/api/rcv");return Array.isArray(e)?e:e.items??[]}catch(e){return console.error("입고 조회 실패",e),[]}},h=async()=>{try{const{data:e}=await b.get("/api/badncode");return Array.isArray(e)?e:e.items??[]}catch(e){return console.error("불량 조회 실패",e),[]}},ee=e=>{Q.value==="create"?(n.value.rcvNo=(e==null?void 0:e.rcv_no)??"",n.value.itemId=(e==null?void 0:e.item_id)??"",n.value.itemName=(e==null?void 0:e.item_name)??"",n.value.lotNo=(e==null?void 0:e.lot_no)??"",n.value.qty=(e==null?void 0:e.qty)??null):(u.value.rcvNo=(e==null?void 0:e.rcv_no)??"",u.value.itemName=(e==null?void 0:e.item_name)??""),C.value=!1},le=e=>{n.value.badnCode=(e==null?void 0:e.BADN_CODE)??"",n.value.badnName=(e==null?void 0:e.BADN_NAME)??"",g.value=!1},V=async()=>{const e={...u.value,fromDate:N(u.value.fromDate),toDate:N(u.value.toDate)},{data:l}=await b.post("/api/iqc/search",e);_.value=Array.isArray(l)?l:l.items??[]},ae=async()=>{u.value={rcvNo:"",itemName:"",result:"전체",fromDate:null,toDate:null},await V()},te=({data:e})=>{n.value={id:e.inspNo??null,rcvNo:e.rcvNo??"",itemId:e.itemId??"",itemName:e.itemName??"",lotNo:e.lotNo??"",qty:e.qty??null,inspDate:p(e.inspDate)??null,result:e.result??"",inspector:e.inspector??"",badnCode:e.badnCode??"",badnName:e.badnName??"",failQty:e.failQty??null,remark:e.remark??""}},E=e=>!!(e.rcvNo&&e.inspDate&&e.result),ne=async()=>{var l,a;if(!E(n.value)){f("필수 항목을 확인하세요. (입고번호/검사일/판정)","warning");return}const e={...n.value,inspDate:N(n.value.inspDate)};try{await b.post("/api/iqc",e),f("등록이 완료되었습니다.","success"),await V(),Y()}catch(v){f(((a=(l=v==null?void 0:v.response)==null?void 0:l.data)==null?void 0:a.message)||"등록 중 오류가 발생했습니다.","error")}},oe=async()=>{var l,a;if(!n.value.id){f("수정할 검사건이 선택되지 않았습니다.","warning");return}if(!E(n.value)){f("필수 항목을 확인하세요. (입고번호/검사일/판정)","warning");return}const e={...n.value,inspDate:N(n.value.inspDate)};try{await b.put(`/api/iqc/${n.value.id}`,e),f("수정이 완료되었습니다.","success"),await V(),Y()}catch(v){f(((a=(l=v==null?void 0:v.response)==null?void 0:l.data)==null?void 0:a.message)||"수정 중 오류가 발생했습니다.","error")}},Y=()=>{n.value={id:null,rcvNo:"",itemId:"",itemName:"",lotNo:"",qty:null,inspDate:null,result:"",inspector:"",badnCode:"",badnName:"",failQty:null,remark:""}};return ue(V),(e,l)=>(ie(),se(me,null,[l[30]||(l[30]=j("h1",null,"입고 품질 검사 등록",-1)),t(y,null,{default:o(()=>[t(B,{elevation:"10",class:"pa-6"},{default:o(()=>[t(z,{class:"py-6 px-6"},{default:o(()=>[t(ve,{title:"검색 조건","btn-text1":"조회","btn-color1":"primary","btn-variant1":"flat",onBtnClick1:V,"btn-text2":"초기화","btn-color2":"warning","btn-variant2":"flat",onBtnClick2:ae})]),_:1}),t(s,{cols:"12",md:"12"},{default:o(()=>[t(y,{dense:""},{default:o(()=>[t(s,{cols:"12",sm:"4"},{default:o(()=>[t(i,{variant:"outlined",label:"입고번호",modelValue:u.value.rcvNo,"onUpdate:modelValue":l[0]||(l[0]=a=>u.value.rcvNo=a),"append-inner-icon":"mdi-magnify","onClick:appendInner":l[1]||(l[1]=I(a=>L("search"),["stop"])),readonly:""},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:o(()=>[t(i,{variant:"outlined",label:"품목명",modelValue:u.value.itemName,"onUpdate:modelValue":l[2]||(l[2]=a=>u.value.itemName=a),readonly:""},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:o(()=>[t(H,{variant:"outlined",label:"판정",items:["전체","합격","불합격"],modelValue:u.value.result,"onUpdate:modelValue":l[3]||(l[3]=a=>u.value.result=a)},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:o(()=>[t(q,{modelValue:M.value,"onUpdate:modelValue":l[6]||(l[6]=a=>M.value=a),"close-on-content-click":!1,transition:"scale-transition","offset-y":""},{activator:o(({props:a})=>[t(i,S(a,{variant:"outlined",label:"검사일(From)","append-inner-icon":"mdi-calendar","model-value":K.value,readonly:""}),null,16,["model-value"])]),default:o(()=>[t(P,{modelValue:R.value,"onUpdate:modelValue":[l[4]||(l[4]=a=>R.value=a),l[5]||(l[5]=a=>{u.value.fromDate=p(a),M.value=!1})]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:o(()=>[t(q,{modelValue:U.value,"onUpdate:modelValue":l[9]||(l[9]=a=>U.value=a),"close-on-content-click":!1,transition:"scale-transition","offset-y":""},{activator:o(({props:a})=>[t(i,S(a,{variant:"outlined",label:"검사일(To)","append-inner-icon":"mdi-calendar","model-value":W.value,readonly:""}),null,16,["model-value"])]),default:o(()=>[t(P,{modelValue:T.value,"onUpdate:modelValue":[l[7]||(l[7]=a=>T.value=a),l[8]||(l[8]=a=>{u.value.toDate=p(a),U.value=!1})]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(y,null,{default:o(()=>[t(B,{elevation:"10",class:"pa-6 mt-2"},{default:o(()=>[t(s,{cols:"12"},{default:o(()=>[j("div",Ve,[t(d(fe),{value:_.value,tableStyle:"min-width: 60rem",rowHover:"",paginator:!0,rows:5,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"RowsPerPageDropdown PrevPageLink PageLinks NextPageLink",onRowClick:te},{default:o(()=>[t(d(m),{field:"inspNo",header:"검사번호"}),t(d(m),{field:"rcvNo",header:"입고번호"}),t(d(m),{field:"itemId",header:"품목번호"}),t(d(m),{field:"itemName",header:"품목명"}),t(d(m),{field:"lotNo",header:"LOT"}),t(d(m),{field:"qty",header:"수량"}),t(d(m),{field:"failQty",header:"불량수량"}),t(d(m),{field:"result",header:"판정"}),t(d(m),{field:"inspector",header:"검사자"}),t(d(m),{field:"inspDate",header:"검사일"},{body:o(({data:a})=>[A(G(a.inspDate?d(D)(a.inspDate).format("YYYY-MM-DD"):""),1)]),_:1}),t(d(m),{field:"remark",header:"비고"})]),_:1},8,["value"])])]),_:1})]),_:1})]),_:1}),t(y,null,{default:o(()=>[t(B,{elevation:"10",class:"pa-6 mt-2"},{default:o(()=>[t(z,{class:"py-6 px-6"},{default:o(()=>[t(pe,{title:"입고 품질 검사 등록","btn-text1":"등록","btn-color1":"primary","btn-variant1":"flat",onBtnClick1:ne,"btn-text2":"수정","btn-color2":"success","btn-variant2":"flat",onBtnClick2:oe,"btn-text3":"신규","btn-color3":"warning","btn-variant3":"flat",onBtnClick3:Y})]),_:1}),t(s,{cols:"12",md:"12"},{default:o(()=>[t(y,{dense:""},{default:o(()=>[t(s,{cols:"12",sm:"4"},{default:o(()=>[t(i,{variant:"outlined",label:"입고번호",modelValue:n.value.rcvNo,"onUpdate:modelValue":l[10]||(l[10]=a=>n.value.rcvNo=a),"append-inner-icon":"mdi-magnify","onClick:appendInner":l[11]||(l[11]=I(a=>L("create"),["stop"])),readonly:"",rules:[a=>!!a||"입고번호는 필수입니다."]},null,8,["modelValue","rules"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:o(()=>[t(i,{variant:"outlined",label:"품목번호",modelValue:n.value.itemId,"onUpdate:modelValue":l[12]||(l[12]=a=>n.value.itemId=a),readonly:""},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:o(()=>[t(i,{variant:"outlined",label:"품목명",modelValue:n.value.itemName,"onUpdate:modelValue":l[13]||(l[13]=a=>n.value.itemName=a),readonly:""},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:o(()=>[t(i,{variant:"outlined",label:"LOT",modelValue:n.value.lotNo,"onUpdate:modelValue":l[14]||(l[14]=a=>n.value.lotNo=a)},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:o(()=>[t(i,{type:"number",variant:"outlined",label:"수량",modelValue:n.value.qty,"onUpdate:modelValue":l[15]||(l[15]=a=>n.value.qty=a),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:o(()=>[t(q,{modelValue:x.value,"onUpdate:modelValue":l[18]||(l[18]=a=>x.value=a),"close-on-content-click":!1,transition:"scale-transition","offset-y":""},{activator:o(({props:a})=>[t(i,S(a,{label:"검사일","append-inner-icon":"mdi-calendar",variant:"outlined","model-value":X.value,readonly:"",rules:[v=>!!n.value.inspDate||"검사일은 필수입니다."]}),null,16,["model-value","rules"])]),default:o(()=>[t(P,{modelValue:$.value,"onUpdate:modelValue":[l[16]||(l[16]=a=>$.value=a),l[17]||(l[17]=a=>{n.value.inspDate=p(a),x.value=!1})]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:o(()=>[t(H,{variant:"outlined",label:"판정",items:["합격","불합격"],modelValue:n.value.result,"onUpdate:modelValue":l[19]||(l[19]=a=>n.value.result=a),rules:[a=>!!a||"판정은 필수입니다."]},null,8,["modelValue","rules"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:o(()=>[t(i,{variant:"outlined",label:"검사자",modelValue:n.value.inspector,"onUpdate:modelValue":l[20]||(l[20]=a=>n.value.inspector=a)},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:o(()=>[t(i,{variant:"outlined",label:"불량명",modelValue:n.value.badnName,"onUpdate:modelValue":l[21]||(l[21]=a=>n.value.badnName=a),"append-inner-icon":"mdi-magnify","onClick:appendInner":l[22]||(l[22]=I(a=>Z(),["stop"])),readonly:""},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"4"},{default:o(()=>[t(i,{type:"number",variant:"outlined",label:"불량수량",modelValue:n.value.failQty,"onUpdate:modelValue":l[23]||(l[23]=a=>n.value.failQty=a),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),t(s,{cols:"12",sm:"8"},{default:o(()=>[t(i,{variant:"outlined",label:"비고",modelValue:n.value.remark,"onUpdate:modelValue":l[24]||(l[24]=a=>n.value.remark=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(J,{visible:C.value,title:"입고번호 선택",idField:"rcv",columns:[{key:"rcv_no",label:"입고번호"},{key:"item_id",label:"품목번호"},{key:"item_name",label:"품목명"},{key:"lot_no",label:"LOT"},{key:"qty",label:"수량"}],fetchData:w,pageSize:10,onSelect:ee,onClose:l[25]||(l[25]=a=>C.value=!1)},null,8,["visible"]),t(J,{visible:g.value,title:"불량 선택",idField:"badn",columns:[{key:"BADN_CODE",label:"불량코드"},{key:"BADN_NAME",label:"불량명"},{key:"UON",label:"사용여부"}],fetchData:h,pageSize:10,onSelect:le,onClose:l[26]||(l[26]=a=>g.value=!1)},null,8,["visible"]),t(re,{modelValue:k.value,"onUpdate:modelValue":l[28]||(l[28]=a=>k.value=a),timeout:1800,color:O.value,location:"top right",rounded:"pill"},{actions:o(()=>[t(de,{variant:"text",onClick:l[27]||(l[27]=a=>k.value=!1)},{default:o(()=>l[29]||(l[29]=[A("닫기")])),_:1})]),default:o(()=>[A(G(F.value)+" ",1)]),_:1},8,["modelValue","color"])],64))}},Be=ce(ye,[["__scopeId","data-v-cdc073c6"]]);export{Be as default};
