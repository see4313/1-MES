import{_ as q}from"./card-header-CLs5wgxG.js";import{_ as B}from"./card-header-btn-DywzlSP9.js";import{s as D,a as d,c as I}from"./index-C6cMUqqj.js";import{a as y}from"./index-NIGUFBhG.js";import{d as M}from"./dayjs.min-CQa8u9th.js";import{_ as E}from"./SnackBar-EkLInYn6.js";import{u as L}from"./useSnackBar-CsLaRa2S.js";import{r as i,m as P,M as T,c as j,o as F,b as e,w as l,Q as R,U as h,T as k,x as K,ap as Q,ac as G,s as O,N as C,u as n,d as m,t as f,a as z,F as A}from"./index-BkcQ_3tW.js";import"./_commonjsHelpers-gnU0ypJ3.js";const H={class:"p-4"},se={__name:"MT-004",setup(J){const{snackBar:u}=L(),_=i({}),p=i({}),w=i(),v=i(!1),r=i(null),c=i({});P(()=>{});const U=async o=>{const a=o.data.procument_id;if(!p.value[a]){const t=await y.get("/api/selectProcDetail",{params:{procId:a}});p.value[a]=t.data}},S=o=>{},Y=(o,a)=>{c.value[o]=a},x=T(()=>r.value?M(r.value).format("YYYY-MM-DD"):""),V=o=>o?M(o).format("YYYY-MM-DD"):"",g=async o=>{v.value=!1;const a={regist_date:x.value};try{const t=await y.get("/api/selectProc",{params:a});w.value=t.data}catch{return u("조회 실패.","error"),[]}},N=o=>{o.totpc=o.remain_qty*o.untpc},$=async()=>{const o=[];if(Object.keys(c.value).forEach(t=>{const s=c.value[t];s&&s.length>0&&o.push(...s)}),o.length===0){u("선택된 항목이 없습니다.","warning");return}if(o.filter(t=>!t.remain_qty||Number(t.remain_qty)<=0).length>0){u("수량이 입력되지 않았거나 0 이하인 항목이 있습니다.","warning");return}if(confirm("등록하시겠습니까?"))try{await y.post("/api/receive",o),u("입고 처리 완료","success"),c.value={},p.value={},await g(r.value),_.value={}}catch(t){console.error(t),u("입고 처리 실패","error")}};return(o,a)=>(F(),j(A,null,[e(C,{elevation:"10"},{default:l(()=>[e(R,{class:"py-6 px-6"},{default:l(()=>[e(B,{title:"발주 상세","btn-text":"입고","btn-variant":"flat","btn-color":"primary",onBtnClick:a[0]||(a[0]=t=>$())}),e(h,{cols:"12",md:"8"},{default:l(()=>[e(k,{justify:"space-between",dense:""},{default:l(()=>[e(h,{cols:"12",sm:"5"},{default:l(()=>[e(K,{modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=t=>v.value=t),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:l(({props:t})=>[e(G,O(t,{modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=s=>r.value=s),label:"발주일자","append-inner-icon":"mdi-calendar",readonly:"",variant:"outlined","model-value":x.value}),null,16,["modelValue","model-value"])]),default:l(()=>[e(Q,{modelValue:r.value,"onUpdate:modelValue":[a[2]||(a[2]=t=>r.value=t),g]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(C,{elevation:"10",class:"mt-3"},{default:l(()=>[e(R,{class:"py-6 px-6"},{default:l(()=>[e(q,{title:"입고 등록"}),e(k,null,{default:l(()=>[e(h,{cols:"12",md:"12"},{default:l(()=>[e(n(D),{expandedRows:_.value,"onUpdate:expandedRows":a[4]||(a[4]=t=>_.value=t),value:w.value,dataKey:"procument_id",onRowExpand:U,onRowCollapse:S,tableStyle:"min-width: 60rem"},{expansion:l(({data:t})=>[z("div",H,[e(n(D),{value:p.value[t.procument_id]||[],dataKey:"pcmt_detail_id",selectionMode:"multiple",selection:c.value[t.procument_id]||[],"onUpdate:selection":s=>Y(t.procument_id,s)},{default:l(()=>[e(n(d),{selectionMode:"multiple",headerStyle:"width: 3em"}),e(n(d),{field:"item_id",header:"품목번호",sortable:"",style:{width:"100px"}}),e(n(d),{field:"item_name",header:"품목명",style:{width:"100px"}}),e(n(d),{field:"spec",header:"규격",style:{width:"100px"}}),e(n(d),{field:"unit",header:"단위",style:{width:"100px"}}),e(n(d),{field:"remain_qty",header:"수량",style:{width:"100px"}},{body:l(({data:s})=>[e(n(I),{modelValue:s.remain_qty,"onUpdate:modelValue":[b=>s.remain_qty=b,b=>N(s)],inputClass:"text-right",style:{width:"100px"},min:0,mode:"decimal",useGrouping:!0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(n(d),{field:"untpc",header:"단가",style:{width:"100px"}},{body:l(s=>[m(f(Number(s.data.untpc).toLocaleString()),1)]),_:2},1024),e(n(d),{field:"totpc",header:"금액",style:{width:"100px"}},{body:l(s=>[m(f(Number(s.data.totpc).toLocaleString()),1)]),_:2},1024)]),_:2},1032,["value","selection","onUpdate:selection"])])]),default:l(()=>[e(n(d),{expander:"",style:{width:"5rem"}}),e(n(d),{field:"procument_id",header:"발주번호"}),e(n(d),{field:"vend_name",header:"거래처명"}),e(n(d),{field:"emp_name",header:"담당자"}),e(n(d),{field:"regist_date",header:"등록일"},{body:l(({data:t})=>[m(f(V(t.regist_date)),1)]),_:1}),e(n(d),{field:"paprd_date",header:"납기일"},{body:l(({data:t})=>[m(f(V(t.paprd_date)),1)]),_:1})]),_:1},8,["expandedRows","value"])]),_:1})]),_:1})]),_:1})]),_:1}),e(E)],64))}};export{se as default};
